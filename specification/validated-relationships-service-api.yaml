# This is an OpenAPI Specification (https://swagger.io/specification/)
# for validated-relationships owned by NHS Digital (https://digital.nhs.uk/)
openapi: "3.0.0"
info:
  title: "Validated Relationships Service API"
  version: "1.6.0"
  description: |
    ## Overview
    Use this API to access the Validated Relationships Service - the national electronic database of relationships
    that have been verified for the purpose of enabling citizens to access patient facing services on behalf of
    (as a proxy for) patients they care for.

    The relationships held by this service are strictly for the purpose of enabling access to healthcare services.
    This is in contrast to the relationships held by the Personal Demographics Service (PDS), which are largely to
    support the provision of direct care.

    You can:

    - get verified relationships (to support decision making when granting proxy access)
    - create a new proxy access request
    - get proxy roles

    In the future you will be able to:

    - update a proxy access request
    - update a proxy relationship
    - delete (revoke) a proxy relationship

    ## Who can use this API
    This API can only be used where there is a legal basis to do so. Make sure you have this and a valid use case before
    you go too far with your development by [contacting us](https://digital.nhs.uk/developer/help-and-support)

    You must do this before you can go live (see 'Onboarding' below).

    ## Related APIs
    The following APIs are related to this API:

    - [Personal Demographics Service - FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir) - we use the data held in PDS as a source of data to verify relationships.

    ## API status and roadmap
    This API is [in production, beta](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#statuses), meaning:
    - we might make breaking changes, but only if we cannot avoid it, and we will give advance notice

    ## Service level
    This API is a bronze service, meaning it is operational and supported only during business hours (8am to 6pm), Monday to Friday excluding bank holidays.

    For more details, see [service levels](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#service-levels).

    ## Technology
    This API is [RESTful](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#basic-rest).

    It conforms to the [FHIR](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#fhir) global standard for health care data exchange, specifically to [FHIR R4 (v4.0.1)](https://hl7.org/fhir/r4/), except that it does not support the [capabilities](http://hl7.org/fhir/R4/http.html#capabilities) interaction.

    It includes some country-specific FHIR extensions, which are built against [FHIR UK Core](https://digital.nhs.uk/services/fhir-uk-core), specifically [UK.core.r4 1.0.0](https://simplifier.net/packages/uk.core.r4/1.0.0).

    You do not need to know much about FHIR to use this API - FHIR APIs are just RESTful APIs that follow specific rules.
    In particular:
    - resource names are capitalised and singular, for example `/RelatedPerson` not `/relatedpersons`
    - array names are singular, for example `name` not `names` for the recorded names of a patient

    There are [libraries and SDKs available](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) to help with FHIR API integration.

    ## Network access
    This API is available on the internet.

    For more details see [Network access for APIs](https://digital.nhs.uk/developer/guides-and-documentation/network-access-for-apis).

    ## Security and authorisation

    This API supports both [user-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis) and [application-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#application-restricted-apis) access types with the following access modes:

    | Access mode                   | Access type            |
    |-------------------------------|------------------------|
    | Patient access                | User-restricted        |
    | Healthcare worker access      | User-restricted        |
    | Application-restricted access | Application-restricted |

    For more information on access modes and how to use them, see the developer [security and authorisation guide](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation).

    ### User-restricted access

    User-restricted access meaning an end user must be present, authenticated and authorised.

    #### Patient access mode
    If the end user is a patient then you must use this access mode.

    [Review all patient access modes](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#patient-access-mode)

    Validated Relationships Service API checks the patient is P9 verified and has a high [vector of trust](https://nhsconnect.github.io/nhslogin/vectors-of-trust/) (VOT).

    Allowed vectors of trust are:
    - `P9.Cp.Cd`
    - `P9.Cp.Ck`
    - `P9.Cm`

    #### Healthcare worker access mode
    If the end user is a healthcare worker then you must use this access mode.

    [Review all CIS2 healthcare worker access modes](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#healthcare-worker-access-mode)

    ### Application-restricted access

    This API is application-restricted, meaning we authenticate the calling application but not the end user.

    [Review all application-restricted access modes](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#application-restricted-apis)

    ## Headers
    This API is case-insensitive when processing request headers, meaning it will accept headers regardless of the letter casing used. (e.g. X-Request-Id, x-request-id are treated the same). When sending headers back in the response, we preserve the exact casing as received in the original request.

    ## Errors
    We use standard HTTP status codes to show whether an API request succeeded or not. They are usually in the range:

    * 200 to 299 if it succeeded, including code 202 if it was accepted by an API that needs to wait for further action
    * 400 to 499 if it failed because of a client error by your application
    * 500 to 599 if it failed because of an error on our server

    Errors specific to each API are shown in the Endpoints section, under Response. See our [reference guide](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#http-status-codes) for more on errors.

    ## Open source
    You might find the following [open source](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#open-source) resources useful:

    | Resource                         | Description                                                                                                  | Links                                                                                                                                                          |
    | -------------------------------- | ------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
    | Validated Relationships FHIR API | Source code for the API proxy, sandbox and specification.                                                    | [GitHub repo](https://github.com/NHSDigital/validated-relationships-service-api)                                                                               |
    | FHIR libraries and SDKs          | Various open source libraries for integrating with FHIR APIs.                                                | [FHIR libraries and SDKs](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks)                   |
    | nhs-number                       | Python package containing utilities for NHS numbers including validity checks, normalisation and generation. | [GitHub repo](https://github.com/uk-fci/nhs-number) \| [Python Package index](https://pypi.org/project/nhs-number/) \| [Docs](https://nhs-number.uk-fci.tech/) |

    We currently don't have any open source client libraries or sample code for this API and the source code for the PDS FHIR back end (the Core Spine source code) is not currently in the open. If you think this would be useful, [contact us](https://digital.nhs.uk/developer/help-and-support).

    ## Environments and testing
    | Environment       | Base URL                                                                             |
    | ----------------- | ------------------------------------------------------------------------------------ |
    | Sandbox           | `https://sandbox.api.service.nhs.uk/validated-relationships/FHIR/R4/`                |
    | Integration test  | `https://int.api.service.nhs.uk/validated-relationships/FHIR/R4/`                    |
    | Production        | `https://api.service.nhs.uk/validated-relationships/FHIR/R4/`                        |

    ### Sandbox testing
    Our [sandbox environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#sandbox-testing)

    * is for early developer testing
    * only covers a limited set of scenarios
    * is open access, so does not allow you to test authorisation

    [<img src="https://run.pstmn.io/button.svg" alt="Run In Postman" style="width: 128px; height: 32px;">](https://app.getpostman.com/run-collection/45653607-8a3d3121-ca56-4ac8-9d14-cd375ee158fc?action=collection%2Ffork&source=rip_markdown&collection-url=entityId%3D45653607-8a3d3121-ca56-4ac8-9d14-cd375ee158fc%26entityType%3Dcollection%26workspaceId%3Db7b0feaf-e9be-4780-8e09-d82c6f42138c)

    ### Integration testing

    Our [integration test environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing)

    * is for formal integration testing
    * includes authorisation with NHS Login

    ## Onboarding
    You must get your software onboarded before it can go live.

    For more details, contact us at [england.vrs-team@nhs.net](mailto:england.vrs-team@nhs.net).

    ## Contact us
    For help and support connecting to our APIs and to join our developer community, see [Help and support building healthcare software](https://digital.nhs.uk/developer/help-and-support).

  contact:
    name: "Validated Relationships Service API Support"
    url: "https://digital.nhs.uk/developer/help-and-support"
    email: api.management@nhs.net
servers:
  - url: "https://sandbox.api.service.nhs.uk/validated-relationships/FHIR/R4"
    description: Sandbox environment.
  - url: "https://int.api.service.nhs.uk/validated-relationships/FHIR/R4"
    description: Integration test environment.
  - url: "https://api.service.nhs.uk/validated-relationships/FHIR/R4"
    description: Production environment.
paths:
  /QuestionnaireResponse:
    post:
      summary: New Access request
      description: |
        ## Overview
        For any new access request, the necessary details should be collected from a user facing service e.g.
        Proxy Access Service and submitted as a QuestionnaireResponse.

        For the most part demographics information doesn't need to be provided in the access request since it can be pulled from PDS.

        ## Access modes

        This endpoint supports the following access modes:
        - Patient access

        ## Sandbox test scenarios

        | Scenario               | Request                                                                                     | Response                                                    |
        | ---------------------- | ------------------------------------------------------------------------------------------- | ----------------------------------------------------------- |
        | Successful request     | Valid request with performer identifier value of 9000000009 or 9000000017                   | HTTP Status 200 Success response                            |
        | Duplicate relationship | Request for relationship that already exists, with performer identifier value of 9000000049 | HTTP Status 409 and DUPLICATE_RELATIONSHIP error response   |


        ### Sandbox constraints
          - Questionnaire Response is not validated.
          - Headers are not tested. `X-Request-ID` and `X-Correlation-ID` are disregarded.

        Or perhaps you'd like to try out the sandbox using our 'Try it out' feature.

      operationId: new-access-request
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/RequestID"
        - $ref: "#/components/parameters/CorrelationID"
      requestBody:
        description: FHIR QuestionnaireResponse
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: "#/components/schemas/QuestionnaireResponse"
            examples:
              questionnaireResponseMotherChildRequest:
                $ref: "./examples/requests/POST_QuestionnaireResponse/mother-child.yaml#/QuestionnaireResponseMotherChildRequest"
              questionnaireResponseAdultToAdultWithoutCapacityRequest:
                $ref: "./examples/requests/POST_QuestionnaireResponse/adult-to-adult-without-capacity.yaml#/QuestionnaireResponseAdultToAdultWithoutCapacityRequest"
              questionnaireResponseAdultToAdultWithCapacityRequest:
                $ref: "./examples/requests/POST_QuestionnaireResponse/adult-to-adult-with-capacity.yaml#/QuestionnaireResponseAdultToAdultWithCapacityRequest"
              questionnaireResponseAdultNominatesAdultRequest:
                $ref: "./examples/requests/POST_QuestionnaireResponse/adult-nominates-adult.yaml#/QuestionnaireResponseAdultNominatesAdultRequest"
              questionnaireResponseDuplicateRelationship:
                $ref: "./examples/requests/POST_QuestionnaireResponse/duplicate_relationship.yaml#/QuestionnaireResponseDuplicateRelationship"
          application/fhir+json; charset=utf-8:
            schema:
              $ref: "#/components/schemas/QuestionnaireResponse"
            examples:
              questionnaireResponseMotherChildRequest:
                $ref: "./examples/requests/POST_QuestionnaireResponse/mother-child.yaml#/QuestionnaireResponseMotherChildRequest"
              questionnaireResponseAdultToAdultWithoutCapacityRequest:
                $ref: "./examples/requests/POST_QuestionnaireResponse/adult-to-adult-without-capacity.yaml#/QuestionnaireResponseAdultToAdultWithoutCapacityRequest"
              questionnaireResponseAdultToAdultWithCapacityRequest:
                $ref: "./examples/requests/POST_QuestionnaireResponse/adult-to-adult-with-capacity.yaml#/QuestionnaireResponseAdultToAdultWithCapacityRequest"
              questionnaireResponseAdultNominatesAdultRequest:
                $ref: "./examples/requests/POST_QuestionnaireResponse/adult-nominates-adult.yaml#/QuestionnaireResponseAdultNominatesAdultRequest"
              questionnaireResponseDuplicateRelationship:
                $ref: "./examples/requests/POST_QuestionnaireResponse/duplicate_relationship.yaml#/QuestionnaireResponseDuplicateRelationship"
      responses:
        "200":
          description: Request was received successfully for processing
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                postQuestionnaireResponseSuccess:
                  $ref: "./examples/responses/POST_QuestionnaireResponse/success.yaml#/PostQuestionnaireResponseSuccess"
        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code               | Description                                                                                                                               |
            | ----------- | ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `MISSING_VALUE`          | Missing header or parameter. For details, see the `diagnostics` field.                                                                    |
            | 400         | `INVALID_VALUE`          | Invalid Parameter or Invalid operation.                                                                                                   |
            | 401         | `ACCESS_DENIED`          | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`              | Access denied to resource.                                                                                                                |
            | 404         | `INVALIDATED_RESOURCE`   | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 405         | `METHOD_NOT_ALLOWED`     | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`                | Request timed out.                                                                                                                        |
            | 409         | `DUPLICATE_RELATIONSHIP` | A proposed proxy role already exists for this proxy/patient relationship.                                                               |
            | 415         | `UNSUPPORTED_MEDIA`      | Unsupported media type.                                                                                                                   |
            | 429         | `THROTTLED`              | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                accessDeniedError:
                  $ref: "./examples/responses/errors/access-denied.yaml#/AccessDeniedError"
                postQuestionnaireResponseDuplicateRelationshipError:
                  $ref: "./examples/responses/POST_QuestionnaireResponse/errors/duplicate_relationship_error.yaml#/PostQuestionnaireResponseDuplicateRelationshipError"
        "5XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                 | Description                                                  |
            | ----------- | -------------------------- | ------------------------------------------------------------ |
            | 500         | `SERVER_ERROR`             | An unexpected internal server error has occurred.            |
            | 502         | `BAD_GATEWAY`              | Connection to the backend service failed.                    |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                internalServerError:
                  $ref: "./examples/responses/errors/internal-server-error.yaml#/InternalServerError"
    get:
      summary: Get a proxy access request
      description: |
        ## Overview
        Retrieve a QuestionnaireResponse using its unique reference code. This endpoint returns the full
        QuestionnaireResponse document that was previously submitted.

        ## Request Requirements
        A valid reference code must be provided as a query parameter. This reference code is returned
        when a QuestionnaireResponse is initially submitted via the POST endpoint.

        ## Access modes

        This endpoint supports the following access modes:
        - Patient access
        - Healthcare worker access

        ## Sandbox test scenarios

        | Scenario                    | Request                    | Response                                                      |
        | --------------------------- | -------------------------- | ------------------------------------------------------------- |
        | Valid reference code        | referenceCode=19318ZGLAB   | HTTP Status 200 with QuestionnaireResponse                    |
        | Invalid reference code      | referenceCode=INVALID      | HTTP Status 400 with INVALID_REFERENCE_CODE message           |
        | Missing reference code      | No referenceCode parameter | HTTP Status 400 with MISSING_REFERENCE_CODE message           |
        | Non-existent reference code | referenceCode=ABC123XY     | HTTP Status 404 with QUESTIONNAIRE_RESPONSE_NOT_FOUND message |

      operationId: get-questionnaire-response
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/RequestID"
        - $ref: "#/components/parameters/CorrelationID"
        - name: referenceCode
          in: query
          description: The unique reference code of the QuestionnaireResponse to retrieve
          required: true
          schema:
            type: string
            example: "19318ZGLAB"
      responses:
        "200":
          description: QuestionnaireResponse successfully retrieved.
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/QuestionnaireResponse"
              examples:
                getQuestionnaireResponseSuccess:
                  $ref: "./examples/responses/GET_QuestionnaireResponse/success.yaml#/GetQuestionnaireResponseSuccess"
        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                         | Description                                                                                                                               |
            | ----------- | ---------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `INVALID_REFERENCE_CODE`           | The reference code must be alphanumeric and exactly 10 characters long.                                                                   |
            | 400         | `INVALID_VALUE`                    | Invalid Parameter or Invalid operation.                                                                                                   |
            | 400         | `MISSING_REFERENCE_CODE`           | The reference code is required but was not provided in the request.                                                                       |
            | 400         | `MISSING_VALUE`                    | Missing header or parameter. For details, see the `diagnostics` field.                                                                    |
            | 401         | `ACCESS_DENIED`                    | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`                        | Access denied to resource.                                                                                                                |
            | 404         | `QUESTIONNAIRE_RESPONSE_NOT_FOUND` | No questionnaire response was found for the provided reference code.                                                                      |
            | 404         | `INVALIDATED_RESOURCE`             | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 405         | `METHOD_NOT_ALLOWED`               | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`                          | Request timed out.                                                                                                                        |
            | 429         | `THROTTLED`                        | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                invalidReferenceCode:
                  $ref: "./examples/responses/GET_QuestionnaireResponse/errors/invalid_reference_code.yaml#/InvalidReferenceCode"
                missingReferenceCode:
                  $ref: "./examples/responses/GET_QuestionnaireResponse/errors/missing_reference_code.yaml#/MissingReferenceCode"
                referenceCodeNotFound:
                  $ref: "./examples/responses/GET_QuestionnaireResponse/errors/questionnaire_response_not_found.yaml#/QuestionnaireResponseNotFound"
        "5XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                 | Description                                                  |
            | ----------- | -------------------------- | ------------------------------------------------------------ |
            | 500         | `SERVER_ERROR`             | An unexpected internal server error has occurred.            |
            | 502         | `BAD_GATEWAY`              | Connection to the backend service failed.                    |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                internalServerError:
                  $ref: "./examples/responses/errors/internal-server-error.yaml#/InternalServerError"
                downstreamServiceError:
                  $ref: "./examples/responses/errors/downstream-service-error.yaml#/DownstreamServiceError"

  /RelatedPerson:
    get:
      summary: Get verified candidate relationships
      description: |
        ## Overview
        Use this endpoint to get candidate proxy relationships for a user with a given NHS Number. This endpoint should NOT be used to retrieve proxy relationships; these should be queried from the `/Consent` endpoint.

        You can (optionally) include `patient:identifier={nhsNumber}` request parameter with the patient's NHS number to get a specific verified relationship for the proxy.

        You can (optionally) include the `_include=RelatedPerson:patient` request parameter to include the patient's details in the response.

        ## Access modes

        This endpoint supports the following access modes:
        - Patient access
        - Healthcare worker access

        ## Sandbox test scenarios

        | Scenario                                                                    | Request                                                                                                | Response                                                                                       |
        | --------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------- |
        | List Relationship                                                           | `identifier`=`9000000017`                                                                              | HTTP Status 200 List of relationships for the proxy                                            |
        | List Relationship and include patient's details                             | `identifier`=`9000000017` and `_include`=`RelatedPerson:patient`                                       | HTTP Status 200 List of relationships for the proxy and includes patient data                  |
        | List Patient Relationship                                                   | `patient:identifier`=`9000000042`                                                                      | HTTP Status 200 List of relationships for the patient                                          |
        | List Patient Relationship and include patient's details                     | `patient:identifier`=`9000000042` and `_include`=`RelatedPerson:patient`                               | HTTP Status 200 List of relationships for the patient and includes proxy data                  |
        | List Relationship and no relationships returned                             | `identifier`=`9000000033`                                                                              | HTTP Status 200 Empty bundle                                                                   |
        | Verify Relationship between proxy and patient                               | `identifier`=`9000000017` and `patient:identifier`=`9000000009`                                        | HTTP Status 200 Verified relationship between patient and proxy                                |
        | Verify Relationship between proxy and patient and include patient's details | `identifier`=`9000000017` and `patient:identifier`=`9000000009` and `_include`=`RelatedPerson:patient` | HTTP Status 200 Verified relationship between patient and proxy and includes patient's details |
        | Verify Relationship between proxy and patient                               | `identifier`=`9000000017` and `patient:identifier`=`9000000025`                                        | HTTP Status 200 Verified relationship between patient and proxy                                |
        | Verify Relationship between proxy and patient and include patient's details | `identifier`=`9000000017` and `patient:identifier`=`9000000025` and `_include`=`RelatedPerson:patient` | HTTP Status 200 Verified relationship between patient and proxy and includes patient's details |
        | Missing identifier                                                          | `patient:identifier`=`9000000009`                                                                      | HTTP Status 400 and MISSING_IDENTIFIER_VALUE error response                                    |
        | Invalid identifier                                                          | `identifier`=`900000000` Note: This identifier is 9 characters long, too short to be NHS Number        | HTTP Status 400 and INVALID_IDENTIFIER_VALUE error response                                    |
        | Invalid identifier system                                                   | `identifier`=`https://fhir.nhs.uk/Id/nhs-number/9730675929`                                            | HTTP Status 400 and INVALID_IDENTIFIER_SYSTEM error response                                   |
        | Identifier not supported in sandbox                                         | `identifier`=`1000000001`                                                                              | HTTP Status 404 and INVALIDATED_RESOURCE error response                                        |

        ### Sandbox constraints
          - Headers are not tested. `X-Request-ID` and `X-Correlation-ID` are disregarded.
          - `patient:identifier` is not validated.

        Or perhaps you'd like to try out the sandbox using our 'Try it out' feature.

      operationId: get-validated-relationships
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/RelatedPersonIdentifier"
        - $ref: "#/components/parameters/PatientIdentifier"
        - $ref: "#/components/parameters/RelatedPersonBundleIncludes"
        - $ref: "#/components/parameters/RequestID"
        - $ref: "#/components/parameters/CorrelationID"
      responses:
        "200":
          description: Information successfully returned.
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/RelatedPersonBundle"
              examples:
                listRelationship:
                  $ref: "./examples/responses/GET_RelatedPerson/list_relationship_9000000017.yaml#/ListRelationship9000000017"
                listRelationshipIncludePatient:
                  $ref: "./examples/responses/GET_RelatedPerson/list_relationship_9000000017_include.yaml#/ListRelationship9000000017Include"
                listChildRelationship:
                  $ref: "./examples/responses/GET_RelatedPerson/list_relationship_9000000042.yaml#/ListRelationship9000000042"
                listChildRelationshipIncludePatient:
                  $ref: "./examples/responses/GET_RelatedPerson/list_relationship_9000000042_include.yaml#/ListRelationship9000000042Include"
                verifyRelationshipExample1:
                  $ref: "./examples/responses/GET_RelatedPerson/verify_relationship_9000000009.yaml#/VerifyRelationship9000000009"
                verifyRelationshipExample1Include:
                  $ref: "./examples/responses/GET_RelatedPerson/verify_relationship_9000000009_include.yaml#/VerifyRelationship9000000009Include"
                verifyRelationshipExample2:
                  $ref: "./examples/responses/GET_RelatedPerson/verify_relationship_9000000025.yaml#/VerifyRelationship9000000025"
                verifyRelationshipExample2Include:
                  $ref: "./examples/responses/GET_RelatedPerson/verify_relationship_9000000025_include.yaml#/VerifyRelationship9000000025Include"
                relatedEmptyResponse:
                  $ref: "./examples/responses/GET_RelatedPerson/empty_response_9000000033.yaml#/RelatedEmptyResponse"

        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                         | Description                                                                                                                               |
            | ----------- | ---------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `INVALID_IDENTIFIER_SYSTEM`        | Invalid identifier system.                                                                                                                |
            | 400         | `INVALID_VALUE`                    | Invalid Parameter or Invalid operation.                                                                                                   |
            | 400         | `MISSING_IDENTIFIER_VALUE`         | Missing RelatedPerson NHS number.                                                                                                         |
            | 400         | `MISSING_VALUE`                    | Missing header or parameter. For details, see the `diagnostics` field.                                                                    |
            | 400         | `INVALID_IDENTIFIER_VALUE`         | Malformed RelatedPerson NHS number.                                                                                                       |
            | 400         | `INVALID_PATIENT_IDENTIFIER_VALUE` | Malformed Patient NHS number.                                                                                                             |
            | 400         | `NOT_SUPPORTED`                    | The request is not currently supported.                                                                                                   |
            | 401         | `ACCESS_DENIED`                    | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`                        | Access denied to resource.                                                                                                                |
            | 404         | `INVALIDATED_RESOURCE`             | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 405         | `METHOD_NOT_ALLOWED`               | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`                          | Request timed out.                                                                                                                        |
            | 429         | `THROTTLED`                        | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                AccessDeniedError:
                  $ref: "./examples/responses/errors/access-denied.yaml#/AccessDeniedError"
                RelatedPersonInvalidIdentifierError:
                  $ref: "./examples/responses/GET_RelatedPerson/errors/invalid-identifier.yaml#/RelatedPersonInvalidIdentifierError"

        "5XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                 | Description                                                  |
            | ----------- | -------------------------- | ------------------------------------------------------------ |
            | 500         | `SERVER_ERROR`             | An unexpected internal server error has occurred.            |
            | 502         | `BAD_GATEWAY`              | Connection to the backend service failed.                    |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                InternalServerError:
                  $ref: "./examples/responses/errors/internal-server-error.yaml#/InternalServerError"

  /Consent:
    get:
      summary: Get proxy roles
      description: |
        ## Overview
        Use this endpoint to get the details about proxy roles, including current status, based on a provided NHS Number.

        Either `performer:identifier` or `patient:identifier` request parameters must be provided. `performer:identifier` and `patient:identifier` can be used together.

        You can (optionally) include `status={status}` request parameter to filter the limit the response to records with a given status bound to the http://hl7.org/fhir/consent-state-codes CodeSystem e.g. `status=active`.

        You can (optionally) include the `_include=Consent:performer` request parameter to include the proxy's details in the response.

        You can (optionally) include the `_include=Consent:patient` request parameter to include the patient's details in the response.

        ## Access modes

        This endpoint supports the following access modes:
        - Patient access
        - Healthcare worker access
        - Application-restricted access

        ## Sandbox test scenarios

        | Scenario                                                                          | Request                                                                                                                                          | Response                                                                                                          |
        | --------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------- |
        | Multiple proxy relationships filtered by 'active' status including details        | `performer:identifier`=`9000000017` and `_include` = `Consent:patient` and `_include` = `Consent:performer` and `status`=`active`                    | HTTP Status 200 Bundle containing a multiple active proxy relationships including performer and patient details   |
        | Multiple proxy relationships filtered by 'inactive' status                        | `performer:identifier`=`9000000017` and `status`=`inactive`                                                                                      | HTTP Status 200 Bundle containing a multiple inactive proxy relationships                                         |
        | Multiple proxy relationships filtered by 'proposed' and 'active' status           | `performer:identifier`=`9000000017` and `status`=`proposed,active`                                                                               | HTTP Status 200 Bundle containing a multiple proposed and active proxy relationships                              |
        | Multiple proxy relationships without filtering and details                        | `performer:identifier`=`9000000022`                                                                                                              | HTTP Status 200 Bundle containing a multiple proxy relationships without details                                  |
        | Multiple proxy relationships including performer details                          | `performer:identifier`=`9000000022` and `_include` = `Consent:performer`                                                                         | HTTP Status 200 Bundle containing a multiple proxy relationships including performer details                      |
        | Multiple proxy relationships including patient details                            | `performer:identifier`=`9000000022` and `_include` = `Consent:patient`                                                                           | HTTP Status 200 Bundle containing a multiple proxy relationships including patient details                        |
        | Multiple proxy relationships including performer and patient details              | `performer:identifier`=`9000000022` and `_include` = `Consent:patient` and `_include` = `Consent:performer`                                          | HTTP Status 200 Bundle containing a multiple proxy relationships including performer and patient details          |
        | Multiple proxy relationships, single patient                                      | `patient:identifier`=`9000000100`                                                                                                                | HTTP Status 200 Bundle containing a multiple proxy relationships including performer and patient details          |
        | Multiple proxy relationships, single patient, including proxy details             | `patient:identifier`=`9000000100` and `_include` = `Consent:performer`                                                                               | HTTP Status 200 Bundle containing a multiple proxy relationships including proxy details                          |
        | Multiple proxy relationships, single patient, including patient details           | `patient:identifier`=`9000000100` and `_include` = `Consent:patient`                                                                             | HTTP Status 200 Bundle containing a multiple proxy relationships including patient details                        |
        | Multiple proxy relationships, single patient, including proxy and patient details | `patient:identifier`=`9000000100` and `_include` = `Consent:patient` and `_include` = `Consent:performer`                                            | HTTP Status 200 Bundle containing a multiple proxy relationships including proxy and patient details              |
        | No proxy relationships                                                            | `performer:identifier`=`9000000025` and `_include` = `Consent:patient` and `_include` = `Consent:performer` and `status` = `active`                  | HTTP Status 200 empty bundle                                                                                      |
        | A single proxy relationship between consenting adults                             | `performer:identifier`=`9000000010` and/or `patient:identifier`=`9000000005`                                                                     | HTTP Status 200 Bundle containing a single proxy relationship                                                     |
        | A single proxy relationship between consenting adults including details           | `performer:identifier`=`9000000010` and/or `patient:identifier`=`9000000005` and `_include` = `Consent:patient` and `_include` = `Consent:proxy` | HTTP Status 200 Bundle containing a single proxy relationship including performer and patient details             |
        | A single proxy relationship between a mother and child                            | `performer:identifier`=`9000000019` and/or `patient:identifier`=`9000000009`                                                                     | HTTP Status 200 Bundle containing a single proxy relationship                                                     |
        | A single proxy relationship between a mother and child including details          | `performer:identifier`=`9000000019` and/or `patient:identifier`=`9000000009` and `_include` = `Consent:patient` and `_include` = `Consent:proxy` | HTTP Status 200 Bundle containing a single proxy relationship including performer and patient details             |
        | Invalid status parameter                                                          | `performer:identifier`=`9000000019` and/or `patient:identifier`=`9000000009` and `status` = `test`                                               | HTTP Status 422 and INVALID_PARAMETER error response                                                                  |
        | Invalid include parameter                                                         | `performer:identifier`=`9000000019` and/or `patient:identifier`=`9000000009` and `_include` = `test`                                             | HTTP Status 422 and INVALID_PARAMETER error response                                                                  |
        | Missing identifier                                                                | `patient:identifier`=`9000000009`                                                                                                                | HTTP Status 400 and MISSING_IDENTIFIER_VALUE error response                                                       |
        | Invalid identifier                                                                | `identifier`=`900000000` Note: This identifier is 9 characters long, too short to be NHS Number                                                  | HTTP Status 422 and INVALID_IDENTIFIER_VALUE error response                                                       |
        | Invalid identifier system                                                         | `identifier`=`https://fhir.nhs.uk/Id/nhs-number/9730675929`                                                                                      | HTTP Status 422 and INVALID_IDENTIFIER_SYSTEM error response                                                      |
        | No performer record found                                                         | `identifier`=`9000000999`                                                                                                                        | HTTP Status 404 and INVALIDATED_RESOURCE error response                                                           |
        | GP Practice not found                                                             | `identifier`=`9000000012`                                                                                                                        | HTTP Status 404 and GP_PRACTICE_NOT_FOUND error response                                                          |

        ### Sandbox constraints
          - Headers are not tested. `X-IM1-Connection-Params`, `X-Request-ID` and `X-Correlation-ID` are disregarded.

      operationId: get-consent
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/ConsentBundlePerformerIdentifier"
        - $ref: "#/components/parameters/ConsentBundlePatientIdentifier"
        - $ref: "#/components/parameters/ConsentStatus"
        - $ref: "#/components/parameters/ConsentBundleIncludes"
        - $ref: "#/components/parameters/RequestID"
        - $ref: "#/components/parameters/CorrelationID"
        - $ref: "#/components/parameters/Im1ConnectionParams"
      responses:
        "200":
          description: Information successfully returned.
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/ConsentBundle"
              examples:
                ConsentMultipleRelationshipsStatusActiveBundle:
                  $ref: "./examples/responses/GET_Consent/filtered-relationships-status-active-include-details.yaml#/ConsentMultipleRelationshipsStatusActiveIncludeDetailsBundle"
                ConsentMultipleRelationshipsStatusInactiveBundle:
                  $ref: "./examples/responses/GET_Consent/filtered-relationships-status-inactive.yaml#/ConsentMultipleRelationshipsStatusInactiveBundle"
                ConsentMultipleRelationshipsStatusProposedActiveBundle:
                  $ref: "./examples/responses/GET_Consent/filtered-relationships-status-proposed-active.yaml#/ConsentMultipleRelationshipsStatusProposedActiveBundle"
                ConsentMultipleRelationshipsBundle:
                  $ref: "./examples/responses/GET_Consent/multiple-relationships.yaml#/ConsentMultipleRelationshipsBundle"
                ConsentMultipleRelationshipsIncludePatientBundle:
                  $ref: "./examples/responses/GET_Consent/multiple-relationships-include-patient.yaml#/ConsentMultipleRelationshipsIncludePatientBundle"
                ConsentMultipleRelationshipsIncludePerformerBundle:
                  $ref: "./examples/responses/GET_Consent/multiple-relationships-include-performer.yaml#/ConsentMultipleRelationshipsIncludePerformerBundle"
                ConsentMultipleRelationshipsIncludePerformerPatientBundle:
                  $ref: "./examples/responses/GET_Consent/multiple-relationships-include-performer-patient.yaml#/ConsentMultipleRelationshipsIncludePerformerPatientBundle"
                ConsentNoRelationshipsEmptyBundle:
                  $ref: "./examples/responses/GET_Consent/no-relationships.yaml#/ConsentNoRelationshipsEmptyBundle"
                ConsentSingleConsentingAdultRelationshipBundle:
                  $ref: "./examples/responses/GET_Consent/single-consenting-adult-relationship.yaml#/ConsentSingleConsentingAdultRelationshipBundle"
                ConsentSingleConsentingAdultRelationshipIncludePerformerPatientBundle:
                  $ref: "./examples/responses/GET_Consent/single-consenting-adult-relationship-include-performer-patient.yaml#/ConsentSingleConsentingAdultRelationshipIncludePerformerPatientBundle"
                ConsentSingleAdultChildRelationshipBundle:
                  $ref: "./examples/responses/GET_Consent/single-mother-child-relationship.yaml#/ConsentSingleAdultChildRelationshipBundle"
                ConsentSingleAdultChildRelationshipIncludePerformerPatientBundle:
                  $ref: "./examples/responses/GET_Consent/single-mother-child-relationship-include-performer-patient.yaml#/ConsentSingleAdultChildRelationshipIncludePerformerPatientBundle"
                ConsentMultipleRelationshipsSinglePatientBundle:
                  $ref: "./examples/responses/GET_Consent/multiple-relationships-single-patient.yaml#/ConsentMultipleRelationshipsSinglePatientBundle"

        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                       | Description                                                                                                                               |
            | ----------- | -------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `MISSING_VALUE`                  | Missing header or parameter. For details, see the `diagnostics` field.                                                                    |
            | 400         | `INVALID_VALUE`                  | Invalid header. For details, see the `diagnostics` field.                                                                                 |
            | 400         | `MISSING_IDENTIFIER_VALUE`       | Missing performer:identifier or patient:identifier value.                                                                                 |
            | 401         | `ACCESS_DENIED`                  | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`                      | Access denied to resource.                                                                                                                |
            | 404         | `INVALIDATED_RESOURCE`           | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 404         | `GP_PRACTICE_NOT_FOUND`          | GP Practice not found.                                                                                                                    |
            | 405         | `METHOD_NOT_ALLOWED`             | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`                        | Request timed out.                                                                                                                        |
            | 422         | `INVALID_IDENTIFIER_SYSTEM`      | Invalid performer:identifier or patient:identifier identifier system.                                                                     |
            | 422         | `INVALID_IDENTIFIER_VALUE`       | Malformed performer:identifier or patient:identifier NHS number.                                                                          |
            | 422         | `INVALID_PARAMETER`              | Invalid parameter. For details, see the `diagnostics` field.                                                                              |
            | 429         | `THROTTLED`                      | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                AccessDeniedError:
                  $ref: "./examples/responses/errors/access-denied.yaml#/AccessDeniedError"
                ConsentInvalidIdentifierError:
                  $ref: "./examples/responses/GET_Consent/errors/invalid-identifier.yaml#/ConsentInvalidIdentifierError"
                ConsentInvalidIdentifierSystemError:
                  $ref: "./examples/responses/GET_Consent/errors/invalid-identifier-system.yaml#/ConsentInvalidIdentifierSystemError"
                ConsentIdentifierMissingError:
                  $ref: "./examples/responses/GET_Consent/errors/missing-identifier.yaml#/ConsentIdentifierMissingError"
                InvalidatedResourceError:
                  $ref: "./examples/responses/errors/invalidated-resource.yaml#/InvalidatedResourceError"
                ConsentInvalidStatusParameterError:
                  $ref: "./examples/responses/GET_Consent/errors/invalid-status-parameter.yaml#/ConsentInvalidStatusParameterError"
                GPPracticeNotFoundError:
                  $ref: "./examples/responses/GET_Consent/errors/gp-practice-not-found.yaml#/GPPracticeNotFoundError"
                InvalidIncludeParameterError:
                  $ref: "./examples/responses/errors/invalid-include-parameter.yaml#/InvalidIncludeParameterError"
        "5XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                 | Description                                                   |
            | ----------- | -------------------------- | ------------------------------------------------------------- |
            | 500         | `SERVER_ERROR`             | An unexpected internal server error has occurred.             |
            | 502         | `BAD_GATEWAY`              | Connection to the backend service failed.                     |
            | 503         | `DOWNSTREAM_SERVICE_ERROR` | A downstream service has failed, request cannot be completed. |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                InternalServerError:
                  $ref: "./examples/responses/errors/internal-server-error.yaml#/InternalServerError"
                DownstreamServiceError:
                  $ref: "./examples/responses/errors/downstream-service-error.yaml#/DownstreamServiceError"
    post:
      summary: Create a proxy role
      description: |
        ## Overview
        Use this endpoint to create a new proxy role between a patient and a related person (proxy).

        ## Access modes

        This endpoint supports the following access modes:
        - Healthcare worker access

        ## Sandbox test scenarios

        The sandbox supports a limited number of scenarios, and does not attempt to validate requests.  The returned result is dependant on the `performer.identifier.value`.

        See the postman collection for an example request body.
        | Scenario                                | Request                                                                                                    | Response                                                    |
        | --------------------------------------- | ---------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- |
        | Successful parent-child proxy creation  | Valid request with a legal basis of parental responsibility, with performer identifier value of 9000000009 | HTTP Status 201 and OperationOutcome response               |
        | Successful adult-adult proxy creation   | Valid request with legal basis of consent, with performer identifier value of 9000000017                   | HTTP Status 201 and OperationOutcome response               |
        | Invalid performer NHS number            | Request with invalid NHS number format, with performer identifier value of 9000000000                      | HTTP Status 422 and INVALID_IDENTIFIER_VALUE error response |
        | Duplicate relationship                  | Request for relationship that already exists, with performer identifier value of 9000000049                | HTTP Status 409 and DUPLICATE_RELATIONSHIP error response   |

      operationId: create-proxy-role
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/RequestID"
        - $ref: "#/components/parameters/CorrelationID"
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: "#/components/schemas/Consent"
            examples:
              parentConsentRequest:
                $ref: "./examples/requests/POST_Consent/parent_child_proxy_creation.yaml#/ConsentParentChildProxyCreationRequest"
              guardianConsentRequest:
                $ref: "./examples/requests/POST_Consent/adult_to_adult_proxy_creation.yaml#/ConsentAdultToAdultGuardianRequest"
      responses:
        "201":
          description: Consent resource successfully created
          headers:
            location:
              schema:
                type: string
                example: https://sandbox.api.service.nhs.uk/validated-relationships/FHIR/R4/Consent/90b9863e-e33c-4895-a333-fd0ea0e23205
              description: URL for the newly created proxy role
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                postConsentSuccess:
                  $ref: "./examples/responses/POST_Consent/success.yaml#/PostConsentSuccess"
        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. For details, see the `diagnostics` field of error. An error occurred as follows:

            | HTTP status | Error code                  | Description                                                                                                                               |
            | ----------- | --------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `INVALID_VALUE`             | Invalid Parameter or Invalid operation.                                                                                                   |
            | 400         | `MISSING_IDENTIFIER_VALUE`  | Missing performer or patient identifier.                                                                                                  |
            | 400         | `MISSING_IDENTIFIER_SYSTEM` | Missing performer or patient identifier system.                                                                                           |
            | 400         | `MISSING_PATIENT`           | Missing patient.                                                                                                                          |
            | 400         | `MISSING_PERFORMER`         | Missing performer.                                                                                                                        |
            | 400         | `MISSING_STATUS`            | Missing status.                                                                                                                           |
            | 400         | `MISSING_SCOPE`             | Missing scope.                                                                                                                            |
            | 400         | `MISSING_CATEGORY`          | Missing category.                                                                                                                         |
            | 400         | `MISSING_DATETIME`          | Missing datetime.                                                                                                                         |
            | 400         | `MISSING_VALUE`             | Missing header or parameter. For details, see the `diagnostics` field.                                                                    |
            | 401         | `ACCESS_DENIED`             | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`                 | Access denied to resource.                                                                                                                |
            | 404         | `INVALIDATED_RESOURCE`      | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 405         | `METHOD_NOT_ALLOWED`        | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`                   | Request timed out.                                                                                                                        |
            | 409         | `DUPLICATE_RELATIONSHIP`    | Conflict with requested proxy role.                                                                                                       |
            | 422         | `INVALID_IDENTIFIER_VALUE`  | Invalid performer or patient identifier value.                                                                                            |
            | 422         | `INVALID_IDENTIFIER_SYSTEM` | Invalid performer or patient identifier system.                                                                                           |
            | 422         | `INVALID_PATIENT`           | Invalid patient.                                                                                                                          |
            | 422         | `INVALID_PERFORMER`         | Invalid performer.                                                                                                                        |
            | 422         | `INVALID_STATUS`            | Invalid status.                                                                                                                           |
            | 422         | `INVALID_SCOPE`             | Invalid scope.                                                                                                                            |
            | 422         | `INVALID_CATEGORY`          | Invalid category.                                                                                                                         |
            | 422         | `INVALID_DATETIME`          | Invalid datetime.                                                                                                                         |
            | 422         | `INVALID_PROVISION`         | Invalid provision.                                                                                                                        |
            | 422         | `INVALID_EXTENSION`         | Invalid extension.                                                                                                                        |
            | 422         | `INVALID_PARAMETER`         | Invalid request parameter. For details, see the diagnostics field.                                                                        |
            | 429         | `THROTTLED`                 | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                postConsentInvalidPerformerIdentifier:
                  $ref: "./examples/responses/POST_Consent/errors/invalid_performer_identifier_error.yaml#/PostConsentInvalidPerformerIdentifierError"
                postConsentDuplicateRelationship:
                  $ref: "./examples/responses/POST_Consent/errors/duplicate_relationship_error.yaml#/PostConsentDuplicateRelationshipError"
                postConsentInvalidIdentifierValue:
                  $ref: "./examples/responses/POST_Consent/errors/invalid_identifier_value.yaml#/PostConsentInvalidIdentifierValueError"
                postConsentInvalidStatus:
                  $ref: "./examples/responses/POST_Consent/errors/invalid_status.yaml#/PostConsentInvalidStatusError"
                postConsentMissingIdentifierSystem:
                  $ref: "./examples/responses/POST_Consent/errors/missing_identifier_system.yaml#/PostConsentMissingIdentifierSystemError"
                postConsentMissingScope:
                  $ref: "./examples/responses/POST_Consent/errors/missing_scope.yaml#/PostConsentMissingScopeError"

        "5XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                 | Description                                                   |
            | ----------- | -------------------------- | ------------------------------------------------------------- |
            | 500         | `SERVER_ERROR`             | An unexpected internal server error has occurred.             |
            | 502         | `BAD_GATEWAY`              | Connection to the backend service failed.                     |
            | 503         | `DOWNSTREAM_SERVICE_ERROR` | A downstream service has failed, request cannot be completed. |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                InternalServerError:
                  $ref: "./examples/responses/errors/internal-server-error.yaml#/InternalServerError"
                DownstreamServiceError:
                  $ref: "./examples/responses/errors/downstream-service-error.yaml#/DownstreamServiceError"

  /Consent/{id}:
    get:
      summary: Get proxy role
      description: |
        ## Overview
        Use this endpoint to get the details of a proxy role, including current status, based on a provided id.

        You can (optionally) include the `_include=Consent:performer` request parameter to include the proxy's details in the response.

        You can (optionally) include the `_include=Consent:patient` request parameter to include the patient's details in the response.

        ## Access modes

        This endpoint supports the following access modes:
        - Healthcare worker access

        ## Sandbox test scenarios

        The sandbox supports a limited number of scenarios, and does not attempt to validate requests.  The returned result is dependant on the `ID` for the consent resource.

        See the postman collection for an example request body.
        | Scenario                                                                         | Request                                                                                                                                  | Response                                                                                                         |
        | -------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
        | Retrieve single consenting adult relationship                                    | Valid request with ID `74eed847-ca25-4e76-8cf2-f2c2d7842a7a`                                                                             | HTTP Status 200 Bundle containing a single active proxy relationship                                             |
        | Retrieve single consenting adult relationship with patient details               | Valid request with ID `74eed847-ca25-4e76-8cf2-f2c2d7842a7a` with parameter `_include=Consent:patient`                                   | HTTP Status 200 Bundle containing a single active proxy relationship with patient details                        |
        | Retrieve single consenting adult relationship with performer details             | Valid request with ID `74eed847-ca25-4e76-8cf2-f2c2d7842a7a` with parameter `_include=Consent:performer`                                 | HTTP Status 200 Bundle containing a single active proxy relationship with performer details                      |
        | Retrieve single consenting adult relationship with performer and patient details | Valid request with ID `74eed847-ca25-4e76-8cf2-f2c2d7842a7a` with parameters `_include=Consent:performer` and `_include=Consent:patient` | HTTP Status 200 Bundle containing a single active proxy relationship with performer details and patient details  |
        | Retrieve single mother-child relationship                                        | Valid request with ID `39df03a2-1b14-4d19-b1dc-d5d8cbf96948`                                                                             | HTTP Status 200 Bundle containing a single active proxy relationship                                             |
        | Retrieve single mother-child relationship with patient details                   | Valid request with ID `39df03a2-1b14-4d19-b1dc-d5d8cbf96948` with parameter `_include=Consent:patient`                                   | HTTP Status 200 Bundle containing a single active proxy relationship with patient details                        |
        | Retrieve single mother-child relationship with performer details                 | Valid request with ID `39df03a2-1b14-4d19-b1dc-d5d8cbf96948` with parameter `_include=Consent:performer`                                 | HTTP Status 200 Bundle containing a single active proxy relationship with performer details                      |
        | Retrieve single mother-child relationship with performer and patient details     | Valid request with ID `39df03a2-1b14-4d19-b1dc-d5d8cbf96948` with parameters `_include=Consent:performer` and `_include=Consent:patient` | HTTP Status 200 Bundle containing a single active proxy relationship with performer details and patient details  |

      operationId: get-consent-by-id
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/ConsentID"
        - $ref: "#/components/parameters/ConsentBundleIncludes"
        - $ref: "#/components/parameters/RequestID"
        - $ref: "#/components/parameters/CorrelationID"
      responses:
        "200":
          description: Information successfully returned.
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/ConsentBundle"
              examples:
                ConsentSingleConsentingAdultRelationshipBundle:
                  $ref: "./examples/responses/GET_Consent/single-consenting-adult-relationship.yaml#/ConsentSingleConsentingAdultRelationshipBundle"
                ConsentSingleConsentingAdultRelationshipIncludePatientBundle:
                  $ref: "./examples/responses/GET_Consent/single-consenting-adult-relationship-include-patient.yaml#/ConsentSingleConsentingAdultRelationshipIncludePatientBundle"
                ConsentSingleConsentingAdultRelationshipIncludePerformerBundle:
                  $ref: "./examples/responses/GET_Consent/single-consenting-adult-relationship-include-performer.yaml#/ConsentSingleConsentingAdultRelationshipIncludePerformerBundle"
                ConsentSingleConsentingAdultRelationshipIncludePerformerPatientBundle:
                  $ref: "./examples/responses/GET_Consent/single-consenting-adult-relationship-include-performer-patient.yaml#/ConsentSingleConsentingAdultRelationshipIncludePerformerPatientBundle"
                ConsentSingleAdultChildRelationshipBundle:
                  $ref: "./examples/responses/GET_Consent/single-mother-child-relationship.yaml#/ConsentSingleAdultChildRelationshipBundle"
                ConsentSingleAdultChildRelationshipIncludePatientBundle:
                  $ref: "./examples/responses/GET_Consent/single-mother-child-relationship-include-patient.yaml#/ConsentSingleAdultChildRelationshipIncludePatientBundle"
                ConsentSingleAdultChildRelationshipIncludePerformerBundle:
                  $ref: "./examples/responses/GET_Consent/single-mother-child-relationship-include-performer.yaml#/ConsentSingleAdultChildRelationshipIncludePerformerBundle"
                ConsentSingleAdultChildRelationshipIncludePerformerPatientBundle:
                  $ref: "./examples/responses/GET_Consent/single-mother-child-relationship-include-performer-patient.yaml#/ConsentSingleAdultChildRelationshipIncludePerformerPatientBundle"

        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                       | Description                                                                                                                               |
            | ----------- | -------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `NOT_SUPPORTED`                  | The request is not currently supported.                                                                                                   |
            | 400         | `MISSING_VALUE`                  | Missing header or parameter. For details, see the `diagnostics` field.                                                                    |
            | 400         | `INVALID_VALUE`                  | Invalid Parameter or Invalid operation.                                                                                                   |
            | 401         | `ACCESS_DENIED`                  | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`                      | Access denied to resource.                                                                                                                |
            | 404         | `INVALIDATED_RESOURCE`           | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 405         | `METHOD_NOT_ALLOWED`             | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`                        | Request timed out.                                                                                                                        |
            | 422         | `INVALID_ID_VALUE`               | Invalid id.                                                                                                                               |
            | 422         | `INVALID_PARAMETER`              | Invalid parameter. For details, see the `diagnostics` field.                                                                              |
            | 429         | `THROTTLED`                      | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                AccessDeniedError:
                  $ref: "./examples/responses/errors/access-denied.yaml#/AccessDeniedError"
                InvalidatedResourceError:
                  $ref: "./examples/responses/errors/invalidated-resource.yaml#/InvalidatedResourceError"
                InvalidIdError:
                  $ref: "./examples/responses/GET_Consent/ID/errors/invalid-id.yaml#/ConsentInvalidIDError"
                InvalidIncludeParameterError:
                  $ref: "./examples/responses/errors/invalid-include-parameter.yaml#/InvalidIncludeParameterError"
        "5XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                 | Description                                                   |
            | ----------- | -------------------------- | ------------------------------------------------------------- |
            | 500         | `SERVER_ERROR`             | An unexpected internal server error has occurred.             |
            | 502         | `BAD_GATEWAY`              | Connection to the backend service failed.                     |
            | 503         | `DOWNSTREAM_SERVICE_ERROR` | A downstream service has failed, request cannot be completed. |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                InternalServerError:
                  $ref: "./examples/responses/errors/internal-server-error.yaml#/InternalServerError"
                DownstreamServiceError:
                  $ref: "./examples/responses/errors/downstream-service-error.yaml#/DownstreamServiceError"
    patch:
      summary: Update a proxy role
      description: |
        ## Overview
        Use this endpoint to update an existing proxy role.

        Common update scenarios include:
        * Revocation of the role (status change from "active" to "inactive")
        * Changing the legal basis of the role (TBC)
        * Updating the end date for time-bound access

        ## Request Requirements
        * The proxy role must exist and be identified by a valid identifier
        * JSON Patch operations must be valid according to RFC 6902
        * Status changes must use valid status codes from <http://hl7.org/fhir/consent-state-codes>

        ## Access modes

        This endpoint supports the following access modes:
        - Patient access
        - Healthcare worker access

        ## Sandbox test scenarios
        The sandbox supports a limited number of scenarios, and does not attempt to validate requests.  The returned response is dependant on the `id` parameters.

        No changes are applied to any records.

        See the postman collection for example requests.

        | Scenario                        | Request                                                                                         | Response                                                      |
        | ------------------------------- | ----------------------------------------------------------------------------------------------- | ------------------------------------------------------------- |
        | Successful status update        | Valid patch changing status to 'active', request with id 'c512b0db-6702-43ee-8c21-bbded2552da9' | HTTP Status 200 and OperationOutcome                          |
        | Successful access level update  | Valid patch modifying the role end date, request with id '6b71ac92-baa3-4b76-b0f5-a601257e2722' | HTTP Status 200 and OperationOutcome                          |
        | Multiple valid changes          | Valid patch with multiple operations, request with id '43003db8-ffcd-4bd6-ab2f-b49b9656f9e5'    | HTTP Status 200 and OperationOutcome                          |
        | Invalid patch format            | Malformed JSON patch document, request with id '849ea584-2318-471b-a24c-cee1b5ad0137'           | HTTP Status 400 and INVALID_PATCH_FORMAT error response       |
        | Invalid path                    | Patch targeting non-existent element, request with id '01abb0c5-b1ac-499d-9655-9cd0b8d3588f'    | HTTP Status 400 and INVALID_PATCH_PATH error response         |
        | Invalid status code             | Patch with invalid status value, request with id '78c35330-fa2f-4934-a5dd-fff847f38de5'         | HTTP Status 422 and INVALID_STATUS_CODE error response        |
        | Invalid status reason           | Patch with invalid status reason value, request with id '51fb4df5-815a-45cd-8427-04d6558336b7'  | HTTP Status 422 and INVALID_STATUS_REASON error response      |
        | Resource not found              | Patch for non-existent Consent, request with an id not listed here                              | HTTP Status 404 and RESOURCE_NOT_FOUND error response         |
        | Invalid state transition        | Patch attempting invalid status change, request with id '7b7f47b8-96e5-43eb-b733-283bf1449f2c'  | HTTP Status 422 and INVALID_STATE_TRANSITION error response   |
      parameters:
        - $ref: "#/components/parameters/ConsentID"
      requestBody:
        required: true
        content:
          application/json-patch+json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/PatchOperation"
            examples:
              statusUpdate:
                $ref: "./examples/requests/PATCH_Consent/replace_status.yaml#/StatusUpdate"
              updateProvision:
                summary: Set an end date for a role
                description: |
                  Example apply end date to a relationship.
                  The relationship will be considered as ended following this date.
                value:
                  - op: replace
                    path: /provision/period/end
                    value: "2026-12-31"
              multipleUpdates:
                summary: Set status to active with an end date
                description: |
                  Example of a combined update to a record.
                  The status will be changed to inactive.
                  The relationship will be considered as ended following this date.
                value:
                  - op: replace
                    path: /status
                    value: active
                  - op: replace
                    path: /provision/period/end
                    value: "2026-12-31"
              replaceLegalBasis:
                $ref: "./examples/requests/PATCH_Consent/replace_legal_basis.yaml#/ReplaceLegalBasisRequest"
      responses:
        "200":
          description: Consent resource successfully updated
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                patchConsentSuccess:
                  $ref: "./examples/responses/PATCH_Consent/success.yaml#/PatchConsentSuccess"

        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. For details, see the `diagnostics` field of error. An error occurred as follows:

            | HTTP status | Error code                  | Description                                                                                                                               |
            | ----------- | --------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `INVALID_VALUE`             | Invalid Parameter or Invalid operation.                                                                                                   |
            | 400         | `INVALID_PATCH_FORMAT`      | Invalid patch format.                                                                                                                     |
            | 400         | `INVALID_PATCH`             | Invalid patch.                                                                                                                            |
            | 400         | `MISSING_VALUE`             | Missing header or parameter. For details, see the `diagnostics` field.                                                                    |
            | 401         | `ACCESS_DENIED`             | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`                 | Access denied to resource.                                                                                                                |
            | 404         | `INVALIDATED_RESOURCE`      | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 405         | `METHOD_NOT_ALLOWED`        | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`                   | Request timed out.                                                                                                                        |
            | 415         | `UNSUPPORTED_MEDIA`         | Unsupported media type.                                                                                                                   |
            | 422         | `INVALID_PATCH_PATH`        | Invalid patch path.                                                                                                                       |
            | 422         | `INVALID_STATUS_CODE`       | Invalid status code.                                                                                                                      |
            | 422         | `INVALID_STATUS_REASON`     | Invalid status reason.                                                                                                                    |
            | 422         | `INVALID_STATE_TRANSITION`  | Invalid state transition.                                                                                                                 |
            | 422         | `INVALID_LEGAL_BASIS_CODE`  | Invalid legal basis code.                                                                                                                 |
            | 422         | `INVALID_END_DATE`          | End date is invalid.                                                                                                                      |
            | 422         | `DUPLICATE_PATCHES`         | Two or more patches use same path.                                                                                                        |
            | 429         | `THROTTLED`                 | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                patchConsentInvalidPatchFormatError:
                  $ref: "./examples/responses/PATCH_Consent/errors/invalid_patch_format.yaml#/PatchConsentInvalidPatchFormatError"
                patchConsentInvalidPathError:
                  $ref: "./examples/responses/PATCH_Consent/errors/invalid_path.yaml#/PatchConsentInvalidPathError"
                patchConsentInvalidStatusCodeError:
                  $ref: "./examples/responses/PATCH_Consent/errors/invalid_status_code.yaml#/PatchConsentInvalidStatusCodeError"
                PatchConsentInvalidStatusReasonError:
                  $ref: "./examples/responses/PATCH_Consent/errors/invalid_status_reason.yaml#/PatchConsentInvalidStatusReasonError"
                patchConsentInvalidStateTransitionError:
                  $ref: "./examples/responses/PATCH_Consent/errors/invalid_state_transition.yaml#/PatchConsentInvalidStateTransitionError"
        "5XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                 | Description                                                   |
            | ----------- | -------------------------- | ------------------------------------------------------------- |
            | 500         | `SERVER_ERROR`             | An unexpected internal server error has occurred.             |
            | 502         | `BAD_GATEWAY`              | Connection to the backend service failed.                     |
            | 503         | `DOWNSTREAM_SERVICE_ERROR` | A downstream service has failed, request cannot be completed. |

          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/OperationOutcome"
              examples:
                InternalServerError:
                  $ref: "./examples/responses/errors/internal-server-error.yaml#/InternalServerError"
                DownstreamServiceError:
                  $ref: "./examples/responses/errors/downstream-service-error.yaml#/DownstreamServiceError"

components:
  schemas:
    QuestionnaireResponse:
      type: object
      description: A FHIR QuestionnaireResponse
      required:
        - status
        - authored
        - source
        - subject
        - questionnaire
      properties:
        resourceType:
          type: string
          description: The FHIR resource type
          enum: ["QuestionnaireResponse"]
        status:
          type: string
          description: The position of the questionnaire response within its overall lifecycle.
          enum: ["completed"]
        authored:
          type: string
          format: date-time
          description: The date time that this set of answers were last changed.
        source:
          type: object
          description: The person who answered the questions about the subject.
          properties:
            type:
              type: string
              enum: [Patient, RelatedPerson]
            identifier:
              description: |
                The person who answered the questions about the subject NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a valid NHS number - see:
                https://www.datadictionary.nhs.uk/attributes/nhs_number.html
              properties:
                system:
                  type: string
                  description: Codesystem URL for source's NHS number.
                  enum: ["https://fhir.nhs.uk/Id/nhs-number"]
                value:
                  type: string
                  description: The source's NHS number.
        subject:
          type: object
          description: The person who is the subject.
          properties:
            type:
              type: string
              enum: [Patient]
            identifier:
              description: |
                The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a valid NHS number - see:
                https://www.datadictionary.nhs.uk/attributes/nhs_number.html
              properties:
                system:
                  type: string
                  description: Codesystem URL for the subject's NHS number.
                  enum: ["https://fhir.nhs.uk/Id/nhs-number"]
                value:
                  type: string
                  description: The subject's NHS number.
        questionnaire:
          type: string
          description: The Questionnaire that defines and organizes the questions for which answers are being provided.
        item:
          type: array
          description: A group or question item from the original questionnaire for which answers are provided.
          items:
            oneOf:
              - $ref: "#/components/schemas/QuestionnaireResponseItem_RelatedPerson"
              - $ref: "#/components/schemas/QuestionnaireResponseItem_ParentalApplicationSupplementaryDetails"
              - $ref: "#/components/schemas/QuestionnaireResponseItem_Patient"
              - $ref: "#/components/schemas/QuestionnaireResponseItem_RequestedAccess"

    QuestionnaireResponseItem_RelatedPerson:
      type: object
      required:
        - linkId
        - text
        - item
      properties:
        linkId:
          type: string
          enum: ["relatedPerson"]
        text:
          type: string
        item:
          type: array
          items:
            oneOf:
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_identifier"]
                  text:
                    type: string
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_name"]
                  text:
                    type: string
                  item:
                    type: array
                    minItems: 2
                    maxItems: 2
                    items:
                      oneOf:
                        - type: object
                          required:
                            - linkId
                            - text
                            - answer
                          properties:
                            linkId:
                              type: string
                              enum: ["relatedPerson_name_first"]
                            text:
                              type: string
                            answer:
                              type: array
                              minItems: 1
                              maxItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string

                        - type: object
                          required:
                            - linkId
                            - text
                            - answer
                          properties:
                            linkId:
                              type: string
                              enum: ["relatedPerson_name_family"]
                            text:
                              type: string
                            answer:
                              type: array
                              minItems: 1
                              maxItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_birthDate"]
                  text:
                    type: string
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueDate:
                              type: string
                              format: date

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_basisForAccess"]
                  text:
                    type: string
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum:
                                    [
                                      "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                                      "https://fhir.hl7.org.uk/CodeSystem/UKCore-AdditionalPersonRelationshipRole",
                                      "https://fhir.nhs.uk/STU3/CodeSystem/RARecord-ProxyRole-1",
                                    ]
                                code:
                                  type: string
                                  enum: ["PRN", "Personal", "002"]
                                display:
                                  type: string
                                  description: FHIR relationship type.
                                  enum:
                                    [
                                      "Parent",
                                      "Personal relationship with the patient",
                                      "Best interest decision made on behalf of the patient (Mental Capacity Act 2005)",
                                    ]

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_relationship"]
                  text:
                    type: string
                  answer:
                    type: array
                    description: The directionality of the relationship is from the RelatedPerson (proxy) to the Patient. For example, if the Patient is a child, and the RelatedPerson is the mother, the relationship would be PRN (parent). Crucially, the relationship type is defined by the role that the proxy plays in the relationship.
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum:
                                    [
                                      "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                                      "http://terminology.hl7.org/CodeSystem/v3-RoleClass",
                                      "https://fhir.hl7.org.uk/CodeSystem/UKCore-AdditionalPersonRelationshipRole",
                                    ]
                                code:
                                  type: string
                                  enum:
                                    [
                                      "PRN",
                                      "CHILD",
                                      "SPS",
                                      "FAMMEMB",
                                      "FRND",
                                      "CAREGIVER",
                                      "SIGOTHR",
                                    ]
                                display:
                                  type: string
                                  description: FHIR relationship type.
                                  enum:
                                    [
                                      "Parent",
                                      "Child",
                                      "Partner, wife or husband",
                                      "Other family member",
                                      "Friend, neighbour or housemate",
                                      "Paid carer or support worker",
                                      "Other",
                                    ]

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_relationshipMoreinfo"]
                  text:
                    type: string
                  answer:
                    type: array
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

    QuestionnaireResponseItem_ParentalApplicationSupplementaryDetails:
      type: object
      properties:
        linkId:
          type: string
          enum: ["parentalApplicationSupplementaryDetails"]
        text:
          type: string
        item:
          type: array
          items:
            oneOf:
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum:
                      [
                        "parentalApplicationSupplementaryDetails_evidenceOfResponsibility",
                      ]
                  text:
                    type: string
                  answer:
                    type: array
                    description: Evidence of responsibility
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum:
                                    [
                                      "https://fhir.nhs.uk/CodeSystem/Proxy-Placeholder-EvidenceOfResponsibility",
                                    ]
                                code:
                                  type: string
                                  enum:
                                    [
                                      "BRTH",
                                      "ADPT",
                                      "PRNA",
                                      "SPRNA",
                                      "PORD",
                                      "SGORD",
                                      "OTHCOURT",
                                      "OTHR",
                                    ]
                                display:
                                  type: string
                                  description: Evidence of responsibility type.
                                  enum:
                                    [
                                      "Birth certificate",
                                      "Adoption certificate",
                                      "Court-witnessed parental responsibility agreement",
                                      "Court-witnessed step-parent parental responsibility agreement",
                                      "Parental order",
                                      "Special guardianship order",
                                      "Other court order",
                                      "Other",
                                    ]

              - type: object
                properties:
                  linkId:
                    type: string
                    enum:
                      [
                        "parentalApplicationSupplementaryDetails_evidenceOfResponsibilityMoreinfo",
                      ]
                  text:
                    type: string
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum:
                      [
                        "parentalApplicationSupplementaryDetails_isCurrentAddressConfirmed",
                      ]
                  text:
                    type: string
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["parentalApplicationSupplementaryDetails_newAddress"]
                  text:
                    type: string
                  item:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum:
                                [
                                  "parentalApplicationSupplementaryDetails_line1",
                                ]
                            text:
                              type: string
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum:
                                [
                                  "parentalApplicationSupplementaryDetails_line2",
                                ]
                            text:
                              type: string
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum:
                                [
                                  "parentalApplicationSupplementaryDetails_line3",
                                ]
                            text:
                              type: string
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string

                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum:
                                ["parentalApplicationSupplementaryDetails_city"]
                            text:
                              type: string
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum:
                                [
                                  "parentalApplicationSupplementaryDetails_district",
                                ]
                            text:
                              type: string
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum:
                                [
                                  "parentalApplicationSupplementaryDetails_postalCode",
                                ]
                            text:
                              type: string
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum:
                      [
                        "parentalApplicationSupplementaryDetails_liveAtSameAddress",
                      ]
                  text:
                    type: string
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum:
                      [
                        "parentalApplicationSupplementaryDetails_canChildConsent",
                      ]
                  text:
                    type: string
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
              - type: object
                properties:
                  linkId:
                    type: string
                    enum:
                      [
                        "parentalApplicationSupplementaryDetails_reasonNoChildConsent",
                      ]
                  text:
                    type: string
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

    QuestionnaireResponseItem_Patient:
      type: object
      required:
        - linkId
        - text
        - item
      properties:
        linkId:
          type: string
          enum: ["patient"]
        text:
          type: string
        item:
          type: array
          items:
            oneOf:
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["patient_identifier"]
                  text:
                    type: string
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["patient_name"]
                  text:
                    type: string
                  item:
                    type: array
                    minItems: 2
                    maxItems: 2
                    items:
                      oneOf:
                        - type: object
                          required:
                            - linkId
                            - text
                            - answer
                          properties:
                            linkId:
                              type: string
                              enum: ["patient_name_first"]
                            text:
                              type: string
                            answer:
                              type: array
                              minItems: 1
                              maxItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string

                        - type: object
                          required:
                            - linkId
                            - text
                            - answer
                          properties:
                            linkId:
                              type: string
                              enum: ["patient_name_family"]
                            text:
                              type: string
                            answer:
                              type: array
                              minItems: 1
                              maxItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["patient_birthDate"]
                  text:
                    type: string
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueDate:
                              type: string
                              format: date

    QuestionnaireResponseItem_RequestedAccess:
      type: object
      required:
        - linkId
        - text
        - item
      properties:
        linkId:
          type: string
          enum: ["requestedAccess"]
        text:
          type: string
        item:
          type: array
          items:
            oneOf:
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["requestedAccess_accessLevel"]
                  text:
                    type: string
                  answer:
                    type: array
                    minItems: 1
                    description: A multiple option selection where multiple access levels can be selected
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum:
                                    [
                                      "https://fhir.nhs.uk/CodeSystem/Proxy-Placeholder-RequestedAccess",
                                    ]
                                code:
                                  type: string
                                  enum:
                                    - "APPT"
                                    - "CNTCT"
                                    - "RECRD"
                                    - "TEST"
                                    - "VACC"
                                    - "PRESCR"
                                display:
                                  type: string
                                  description: FHIR Requested access level.
                                  enum:
                                    - "Appointment Booking"
                                    - "Contacting Surgery"
                                    - "Medical Records Access"
                                    - "Test Results"
                                    - "Vaccination Records"
                                    - "Request and manage repeat prescriptions"

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["requestedAccess_accessLevelMoreinfo"]
                  text:
                    type: string
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["requestedAccess_reasonsForAccess"]
                  text:
                    type: string
                  answer:
                    type: array
                    minItems: 1
                    description: A multiple option selection where multiple reasons can be selected
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum:
                                    [
                                      "https://fhir.nhs.uk/CodeSystem/Proxy-Placeholder-ReasonForAccess",
                                    ]
                                code:
                                  type: string
                                  enum:
                                    - "COMB"
                                    - "MHEA"
                                    - "PHYS"
                                    - "PRAC"
                                    - "TECH"
                                    - "NEUR"
                                    - "LRN"
                                    - "OTHR"
                                    - "NotSpecified"
                                display:
                                  type: string
                                  description: FHIR Reason for access.
                                  enum:
                                    - "Communication Barriers"
                                    - "Mental Health Condition"
                                    - "Physical Condition"
                                    - "Practical Reasons"
                                    - "Technical Barriers"
                                    - "Neurodiverse"
                                    - "Learning Disability"
                                    - "Other"
                                    - "Prefer not to say"

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["requestedAccess_reasonsForAccessMoreinfo"]
                  text:
                    type: string
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

    BaseBundle:
      type: object
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          enum: [Bundle]
        timestamp:
          type: string
          format: date-time
          description: The UTC date and time the search results were returned.
        total:
          type: number
          description: |
            The number of resources contained within the Bundle.

    Searchset:
      allOf:
        - $ref: "#/components/schemas/BaseBundle"
        - type: object
          properties:
            type:
              type: string
              description: Denotes that the Bundle is a collection of resources returned as a result of a search.
              enum: [searchset]

    RelatedPersonBundle:
      allOf:
        - $ref: "#/components/schemas/Searchset"
        - type: object
          properties:
            link:
              type: array
              items:
                type: object
                properties:
                  relation:
                    type: string
                    description: |
                      Links related to this Bundle - see:
                      http://www.iana.org/assignments/link-relations/link-relations.xhtml
                  url:
                    type: string
                    format: uri
            entry:
              type: array
              description: |
                A collection of resources contained within the Bundle.

                An empty bundle suggests that no candidate proxy/patient links were identified.
              items:
                anyOf:
                  - $ref: "#/components/schemas/RelatedPersonWithDetailsBundleEntry"
                  - $ref: "#/components/schemas/PatientBundleEntry"

    ConsentBundle:
      allOf:
        - $ref: "#/components/schemas/Searchset"
        - type: object
          properties:
            entry:
              type: array
              description: |
                A collection of resources contained within the Bundle.

                An empty bundle suggests that the proxy has no proxy relationships.
              items:
                anyOf:
                  - $ref: "#/components/schemas/RelatedPersonBundleEntry"
                  - $ref: "#/components/schemas/PatientBundleEntry"
                  - $ref: "#/components/schemas/ConsentBundleEntry"

    RelatedPersonWithDetailsBundleEntry:
      type: object
      allOf:
        - $ref: "#/components/schemas/RelatedPersonBundleEntry"
        - type: object
          description: A RelatedPerson bundle entry with patient name and birthDate.
          properties:
            resource:
              allOf:
                - $ref: "#/components/schemas/RelatedPerson"
                - type: object
                  properties:
                    name:
                      $ref: "#/components/schemas/PDSName"
                    birthDate:
                      $ref: "#/components/schemas/PDSBirthDate"

    RelatedPersonBundleEntry:
      type: object
      description: A RelatedPerson bundle entry.
      properties:
        fullUrl:
          type: string
          description: The canonical URL of the resource in the entry
        resource:
          $ref: "#/components/schemas/RelatedPerson"
        search:
          type: object
          properties:
            mode:
              type: string
              enum:
                - match
                - include
              example: match

    PatientBundleEntry:
      type: object
      description: A Patient bundle entry.
      properties:
        fullUrl:
          type: string
          description: The canonical URL of the resource in the entry
        resource:
          $ref: "#/components/schemas/Patient"
        search:
          type: object
          properties:
            mode:
              type: string
              enum:
                - match
                - include
              example: match

    ConsentBundleEntry:
      type: object
      description: A Consent bundle entry.
      properties:
        fullUrl:
          type: string
          description: The canonical URL of the resource in the entry
        resource:
          $ref: "#/components/schemas/Consent"
        search:
          type: object
          properties:
            mode:
              type: string
              enum:
                - match
                - include
              example: match

    RelatedPerson:
      type: object
      description: The proxy's details. This includes their relationship to the referenced patient.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          enum: [RelatedPerson]
          default: RelatedPerson
        id:
          type: string
          description: Unique identifier of the RelatedPerson resource.
        identifier:
          type: array
          description: The proxy's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
          items:
            type: object
            properties:
              system:
                type: string
                description: Codesystem URL for the proxy's NHS number.
                enum:
                  [
                    "https://fhir.nhs.uk/Id/nhs-number",
                    "https://placeholder.fhir.nhs.uk/Id/local-gp-patient-identifier",
                  ]
              value:
                type: string
                description: The proxy's NHS number.
        patient:
          type: object
          description: A reference to a patient the proxy is related to.
          properties:
            type:
              type: string
              description: FHIR resource type.
              enum: ["Patient"]
            identifier:
              type: object
              description: The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
              properties:
                system:
                  type: string
                  description: Codesystem URL for the patient's NHS number.
                  enum: ["https://fhir.nhs.uk/Id/nhs-number"]
                value:
                  type: string
                  description: The patient's NHS number.
        relationship:
          type: array
          description: How the proxy is related to the patient.
          items:
            type: object
            properties:
              coding:
                type: array
                description: FHIR coding array.
                items:
                  type: object
                  properties:
                    system:
                      type: string
                      description: FHIR codesystem.
                      default: "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                      enum:
                        [
                          "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                          "https://fhir.hl7.org.uk/CodeSystem/UKCore-AdditionalPersonRelationshipRole",
                        ]
                    code:
                      type: string
                      description: FHIR relationship type code.
                      enum:
                        - "MTH"
                        - "PRN"
                        - "Personal"
                        - "CHILD"
                    display:
                      type: string
                      description: FHIR relationship type.
                      enum:
                        - "mother"
                        - "parent"
                        - "Personal relationship with the patient"
                        - "child"

    Patient:
      type: object
      description: The patient's details.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          enum: [Patient]
          default: Patient
        id:
          type: string
          description: Unique identifier of the Patient resource
        identifier:
          type: array
          description: The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
          items:
            type: object
            properties:
              system:
                type: string
                description: Codesystem URL for the NHS number.
                enum:
                  [
                    "https://fhir.nhs.uk/Id/nhs-number",
                    "https://placeholder.fhir.nhs.uk/Id/local-gp-patient-identifier",
                  ]
              value:
                type: string
                description: The NHS number.
        name:
          $ref: "#/components/schemas/PDSName"
        birthDate:
          $ref: "#/components/schemas/PDSBirthDate"
        generalPractitioner:
          type: array
          description: Patient's nominated primary care provider, each a Reference(Organization | Practitioner | PractitionerRole).
          items:
            $ref: "#/components/schemas/Reference"

    Consent:
      type: object
      required:
        - id
        - status
        - scope
        - category
        - patient
        - dateTime
        - performer
      description: The details of the consent including who the patient and care "performer" are, status of the relationship and whether consent was given by a patient with capacity.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          enum:
            - Consent
          default: Consent
        id:
          type: string
          description: Unique identifier of the Consent resource
        status:
          type: string
          description: "The status of the consent, following the ConsentStateCodes value set."
          enum:
            - draft
            - proposed
            - active
            - rejected
            - inactive
            - entered-in-error
        scope:
          $ref: "#/components/schemas/CodeableConcept"
          description: "The scope of the consent, bound to http://terminology.hl7.org/CodeSystem/consentscope"
        category:
          type: array
          items:
            $ref: "#/components/schemas/CodeableConcept"
          description: "Classification of the type of consent, bound to http://terminology.hl7.org/CodeSystem/v3-ActCode."
        patient:
          $ref: "#/components/schemas/Reference"
          description: "The patient who is the subject of the consent."
        dateTime:
          type: string
          format: date-time
          description: "Date and time when the consent was created."
        performer:
          type: array
          maxItems: 1
          items:
            $ref: "#/components/schemas/Reference"
          description: "Individuals or organizations that agreed to the consent."
        provision:
          $ref: "#/components/schemas/Provision"
        extension:
          type: array
          description: Model the status reason.
          items:
            $ref: "#/components/schemas/Extension"

    Provision:
      type: object
      properties:
        period:
          type: object
          description: "Timeframe for this provision."
          properties:
            start:
              type: string
              description: "Starting time with inclusive boundary"
              format: date-time
            end:
              type: string
              description: "End time with inclusive boundary, if not ongoing"
              format: date-time
        actor:
          type: array
          description: "Individuals or organisations involved in the provision"
          items:
            type: object
            properties:
              reference:
                $ref: "#/components/schemas/Reference"
                description: "Individuals or organizations that agreed to the consent"
              role:
                $ref: "#/components/schemas/CodeableConcept"
                description: "Classification of the role of consent, bound to http://terminology.hl7.org/CodeSystem/v3-RoleCode"

    Extension:
      type: object
      properties:
        url:
          type: string
        valueCodeableConcept:
          type: array
          description: Classification of the status of consent, bound to http://terminology.hl7.org/CodeSystem/consent-reason.
          items:
            $ref: "#/components/schemas/CodeableConcept"

    OperationOutcome:
      type: object
      description: |
        Outcome of an operation that does not result in a resource or bundle being returned, for example an error or an async/batch submission.
        There are a number of possible error codes that can be returned along with a more detailed description in the `display` field.
      properties:
        resourceType:
          type: string
          description: FHIR Resource Type.
          default: OperationOutcome
        issue:
          type: array
          description: List of issues that have occurred.
          minItems: 1
          items:
            type: object
            required:
              - severity
              - code
            properties:
              severity:
                type: string
                enum: [fatal, error, warning, information]
                description: Severity of the error.
              code:
                type: string
                description: FHIR error code.
                enum:
                  - invalid
                  - structure
                  - required
                  - value
                  - invariant
                  - security
                  - login
                  - unknown
                  - expired
                  - forbidden
                  - suppressed
                  - processing
                  - not-supported
                  - duplicate
                  - multiple-matches
                  - not-found
                  - deleted
                  - too-long
                  - code-invalid
                  - extension
                  - too-costly
                  - business-rule
                  - conflict
                  - transient
                  - lock-error
                  - no-store
                  - exception
                  - timeout
                  - incomplete
                  - throttled
                  - informational
              details:
                type: object
                description: Internal error code.
                properties:
                  coding:
                    type: array
                    items:
                      type: object
                      properties:
                        system:
                          type: string
                          description: URI of the coding system specification.
                        version:
                          type: string
                          description: Version of the coding system in use.
                        code:
                          type: string
                          description: Symbol in syntax defined by the system.
                        display:
                          type: string
                          description: Representation defined by the system.
              diagnostics:
                type: string
                description: Additional diagnostic information about the issue. This information is subject to change.
              expression:
                type: string
                description: FHIRPath of element(s) related to the error.

    Reference:
      type: object
      required:
        - identifier
      properties:
        type:
          type: string
          description: The resource type that the reference refers to
        identifier:
          $ref: "#/components/schemas/Identifier"

    Identifier:
      type: object
      required:
        - system
        - value
      properties:
        system:
          type: string
          description: "The namespace for the identifier."
        value:
          type: string
          description: "The value that is unique."

    CodeableConcept:
      type: object
      properties:
        coding:
          type: array
          items:
            $ref: "#/components/schemas/Coding"
        text:
          type: string
          description: "Plain text representation of the concept."

    Coding:
      type: object
      properties:
        system:
          type: string
          description: "The identification of the code system that defines the meaning of the code."
        code:
          type: string
          description: "The actual code from the code system."
        display:
          type: string
          description: "A human-readable representation of the code."

    PatchOperation:
      type: object
      required:
        - op
        - path
      properties:
        op:
          type: string
          enum: [add, remove, replace]
        path:
          type: string
          enum:
            - /status
            - /provision/period/end
            - /provision/actor
            - /extension
        value:
          oneOf:
            - type: string
            - type: array
              items:
                type: object

    PDSName:
      type: array
      description: List of names associated with the patient.
      items:
        type: object
        required:
          - use
          - family
        additionalProperties: false
        properties:
          id:
            type: string
            description: Unique object identifier for this name.
          use:
            type: string
            description: |
              How this name should be used.
              * usual - Known as, conventional or the one patient normally uses. A patient always has a usual name.
              * temp - An alias or temporary name. This may also be used for temporary names assigned at birth or in emergency situations.
              * nickname - A name that the patient prefers to be addressed by, but is not part of their usual name.
              * old - This name is no longer in use (or was never correct, but retained for records).
              * maiden - Name changed for Marriage. A name used prior to changing name because of marriage. This term is not gender specific. The use of this term does not imply any particular history for a person's name.

              The following use codes are included in the [name-use](https://www.hl7.org/fhir/valueset-name-use.html) value set, but should not be used and is not be returned as part of a retrieval.
              * official - The formal name as registered in an official (government) registry, but which name might not be commonly used. May be called "legal name".
              * anonymous - Anonymous assigned name, alias, or pseudonym (used to protect a person's identity for privacy reasons).
            enum: [usual, temp, nickname, old, maiden]
          period:
            type: object
            description: |
              Business effective period when the name was, is, or will be in use.
            required:
              - start
            properties:
              start:
                type: string
                format: date
                description: Start date of time period, if known, in format `yyyy-mm-dd`. Can be a future date.
              end:
                type: string
                format: date
                description: End date of time period, if known and if not ongoing, in format `yyyy-mm-dd`. Can be a future date.
          given:
            type: array
            maxItems: 5
            description: |
              Given names, including any middle names.

              Each name(s) should be a separate item in the list. The first given name may include multiple names, separated by a space.
              Subsequent names must be broken down into list items. For example, the input `[Jane Marie Anne, Jo Adele]` returns `[Jane Marie Anne, Jo, Adele]`.

            items:
              type: string
              maxLength: 35
          family:
            type: string
            maxLength: 35
            description: Family name (often called Surname).
          prefix:
            type: array
            description: Name prefixes, titles, and prenominals.
            items:
              type: string
          suffix:
            type: array
            description: Name suffices and postnominals.
            items:
              type: string

    PDSBirthDate:
      description: |
        The date on which the patient was born or is officially deemed to have been born.

        It is a date in the format `yyyy-mm-dd`. Due to data quality issues on a small number of patients `yyyy-mm` and `yyyy` format may also be returned.
      type: string
      format: date

  parameters:
    RelatedPersonIdentifier:
      in: query
      name: identifier
      description: |
        The proxy's NHS number. For more information on FHIR tokens in general, [see here](https://build.fhir.org/search.html#token).
      required: false
      schema:
        type: string
        format: token
      examples:
        withoutSystem:
          value: 9000000017
          summary: NHS number specified without system.
        withSystem:
          value: https://fhir.nhs.uk/Id/nhs-number|9000000017
          summary: System and NHS number specified

    PatientIdentifier:
      in: query
      name: patient:identifier
      description: |
        The patient's NHS number. For more information on FHIR tokens in general, [see here](https://build.fhir.org/search.html#token).
      required: false
      schema:
        type: string
        format: token
      examples:
        withoutSystem:
          value: 9000000009
          summary: NHS number specified without system
        withSystem:
          value: https://fhir.nhs.uk/Id/nhs-number|9000000009
          summary: System and NHS number specified

    ConsentBundlePerformerIdentifier:
      in: query
      name: performer:identifier
      description: |
        The performer's (Proxy) NHS number. For more information on FHIR tokens in general, [see here](https://build.fhir.org/search.html#token).
      required: false
      schema:
        type: string
        format: token
      examples:
        withoutSystem:
          value: 9000000017
          summary: NHS number specified without system
        withSystem:
          value: https://fhir.nhs.uk/Id/nhs-number|9000000017
          summary: System and NHS number specified

    ConsentBundlePatientIdentifier:
      in: query
      name: patient:identifier
      description: |
        The patient's NHS number. For more information on FHIR tokens in general, [see here](https://build.fhir.org/search.html#token).
      required: false
      schema:
        type: string
        format: token
      examples:
        withoutSystem:
          value: 9000000017
          summary: NHS number specified without system
        withSystem:
          value: https://fhir.nhs.uk/Id/nhs-number|9000000017
          summary: System and NHS number specified

    RelatedPersonBundleIncludes:
      in: query
      name: _include
      description: |
        Include referenced resources in the bundle response by specifying one or more `_include` parameters. Further info [here](https://www.hl7.org/fhir/search.html#_include).
      required: false
      style: form
      explode: true
      schema:
        type: array
        items:
          type: string
          enum:
            - "RelatedPerson:patient"
      examples:
        IncludePatient:
          summary: Include the patient in the bundle
          value:
            - "RelatedPerson:patient"

    ConsentBundleIncludes:
      in: query
      name: _include
      description: Include referenced resources in the bundle response by specifying one or more `_include` parameters. Further info [here](https://www.hl7.org/fhir/search.html#_include).
      required: false
      style: form
      explode: true
      schema:
        type: array
        items:
          type: string
          enum:
            - "Consent:performer"
            - "Consent:patient"
      examples:
        IncludePerformer:
          summary: Include the performer (proxy) in the bundle
          value: Consent:performer
        IncludePatient:
          summary: Include the patient in the bundle
          value: Consent:patient
        FullInclude:
          summary: Include the performer (Proxy) and patient in the bundle
          value:
            - "Consent:performer"
            - "Consent:patient"

    ConsentStatus:
      in: query
      name: status
      description: Specify one or more `status` to filter the records returned in the bundle. For example you can filter to only `active` or `proposed` proxy relationships.
      required: false
      style: form
      explode: true
      schema:
        type: array
        items:
          type: string
          enum:
            - draft
            - proposed
            - active
            - rejected
            - inactive
            - entered-in-error
      examples:
        Active:
          summary: Only active authorised proxy relationships
          value: active
        Revoked:
          summary: Only revoked proxy relationships
          value: inactive
        ActiveOrProposed:
          summary: Active OR proposed (but not yet authorised) proxy relationships
          value:
            - proposed
            - active

    BearerAuthorization:
      in: header
      name: Authorization
      description: |
        An [OAuth 2.0 bearer token](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis).
      required: true
      schema:
        type: string
        format: '^Bearer\ [[:ascii:]]+$'
        example: "Bearer g1112R_ccQ1Ebbb4gtHBP1aaaNM"

    RequestID:
      in: header
      name: X-Request-ID
      required: true
      description: |
        A globally unique identifier (GUID) for the request, which we use to correlate logs through different components.
        Must be a universally unique identifier (UUID) (ideally version 4).
        Mirrored back in a response header.
      schema:
        type: string
        format: uuid
        pattern: "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
        example: 60E0B220-8136-4CA5-AE46-1D97EF59D068

    CorrelationID:
      in: header
      name: X-Correlation-ID
      required: false
      description: |
        An optional ID which you can use to track transactions across multiple systems.
        Must be a universally unique identifier (UUID) (ideally version 4).
        Mirrored back in a response header.
      schema:
        type: string
        format: uuid
        pattern: "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
        example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA

    Im1ConnectionParams:
      in: header
      name: X-IM1-Connection-Params
      required: false
      description: |
        An optional `;` delimited string containing parameters required to refresh proxy relationships from GPIT supplier systems. Parameters that comprise this string are:

        - IM1 User Connection token
        - ODS Code
      schema:
        type: string
        pattern: "^[^;]+;[^;]+$"
        example: NiV3CyMJH3xYV26ghlVpbbjT7pDVEA8HpFczAjRLTs1VezC4CYzupZ3XxXAWM7ELuseqrV8r0Ill7EL7G2tXUaVHCPWgg4q10+MxFjnRPrjDvckBRSZazqZcp0K2VBdUV0rZ7RUYJNJsjVAeefWhiK/Y4R+GFO86QDpt41JS9xA=;G123456

    ConsentID:
      in: path
      name: id
      required: true
      description: The logical id of the Consent resource
      schema:
        type: string
        format: uuid
        pattern: "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
        example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA
