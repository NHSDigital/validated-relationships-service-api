# This is an OpenAPI Specification (https://swagger.io/specification/)
# for validated-relationships owned by NHS Digital (https://digital.nhs.uk/)
openapi: '3.0.0'
info:
  title: 'Validated Relationships Service API'
  version: '1.2.1'
  description: |
    ## Overview
    Use this API to access the Validated Relationships Service - the national electronic database of relationships
    that have been verified for the purpose of enabling citizens to access patient facing services on behalf of
    (as a proxy for) patients they care for.

    The relationships held by this service are strictly for the purpose of enabling access to healthcare services.
    This is in contrast to the relationships held by the Personal Demographics Service (PDS), which are largely to
    support the provision of direct care.

    You can:

    - get verified relationships (to support decision making when granting proxy access)
    - create a new proxy access request
    - get proxy relationships

    In the future you will be able to:

    - update a proxy access request
    - update a proxy relationship
    - delete (revoke) a proxy relationship

    ## Who can use this API
    This API can only be used where there is a legal basis to do so. Make sure you have this and a valid use case before
    you go too far with your development by [contacting us](https://digital.nhs.uk/developer/help-and-support)

    You must do this before you can go live (see 'Onboarding' below).

    ## Related APIs
    The following APIs are related to this API:

    - [Personal Demographics Service - FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir) - we use the data held in PDS as a source of data to verify relationships.

    ## API status and roadmap
    This API is [in production, beta](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#statuses), meaning:
    - we might make breaking changes, but only if we cannot avoid it, and we will give advance notice

    If you would like to be involved in our beta programme, [contact us](https://digital.nhs.uk/developer/help-and-support).

    ### Roadmap
    To see our roadmap, or to suggest, comment or vote on features for this API, see our [interactive product backlog](https://nhs-digital-api-management.featureupvote.com/?order=popular&filter=allexceptdone&tag=vrs-api).

    If you have any other queries, please [contact us](https://digital.nhs.uk/developer/help-and-support).

    ## Service level
    This API is a bronze service, meaning it is operational and supported only during business hours (8am to 6pm), Monday to Friday excluding bank holidays.

    For more details, see [service levels](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#service-levels).

    ## Technology
    This API is [RESTful](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#basic-rest).

    It conforms to the [FHIR](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#fhir) global standard for health care data exchange, specifically to [FHIR R4 (v4.0.1)](https://hl7.org/fhir/r4/), except that it does not support the [capabilities](http://hl7.org/fhir/R4/http.html#capabilities) interaction.

    It includes some country-specific FHIR extensions, which are built against [FHIR UK Core](https://digital.nhs.uk/services/fhir-uk-core), specifically [UK.core.r4 1.0.0](https://simplifier.net/packages/uk.core.r4/1.0.0).

    You do not need to know much about FHIR to use this API - FHIR APIs are just RESTful APIs that follow specific rules.
    In particular:
    - resource names are capitalised and singular, for example `/RelatedPerson` not `/relatedpersons`
    - array names are singular, for example `name` not `names` for the recorded names of a patient

    There are [libraries and SDKs available](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) to help with FHIR API integration.

    ## Network access
    This API is available on the internet.

    For more details see [Network access for APIs](https://digital.nhs.uk/developer/guides-and-documentation/network-access-for-apis).

    ## Security and authorisation

    This API is [user-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis), meaning an end user must be present, authenticated and authorised.

    The end user must be:
    * a patient who receives health and social care or makes use of NHS services
    * strongly authenticated, using [NHS login](https://digital.nhs.uk/services/nhs-login)

    To use this access mode, use one of the following security patterns:

    |	Security pattern		                                                                                                                                                                                                          |	Technical details	                                  |	Advantages	                                                | Disadvantages                                           |
    |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| ----------------------------------------------------| ------------------------------------------------------------|---------------------------------------------------------|
    |[NHS login - combined authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-login-combined-authentication-and-authorisation) |OAuth 2.0 authorisation code with API key and secret |No need to integrate and onboard separately with NHS login.  |No access to user information.                           |
    |[NHS login - separate authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-login-separate-authentication-and-authorisation) |OAuth 2.0 token exchange with signed JWT             |Gives access to user information.                            |Need to integrate and onboard separately with NHS login. |

    ## Errors
    We use standard HTTP status codes to show whether an API request succeeded or not. They are usually in the range:

    * 200 to 299 if it succeeded, including code 202 if it was accepted by an API that needs to wait for further action
    * 400 to 499 if it failed because of a client error by your application
    * 500 to 599 if it failed because of an error on our server

    Errors specific to each API are shown in the Endpoints section, under Response. See our [reference guide](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#http-status-codes) for more on errors.

    ## Open source
    You might find the following [open source](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#open-source) resources useful:

    | Resource                  | Description                                                          | Links                                                                          |
    |---------------------------|----------------------------------------------------------------------|--------------------------------------------------------------------------------|
    | Validated Relationships FHIR API              | Source code for the API proxy, sandbox and specification.            | [GitHub repo](https://github.com/NHSDigital/validated-relationships-service-api) |
    | FHIR libraries and SDKs   | Various open source libraries for integrating with FHIR APIs.        | [FHIR libraries and SDKs](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) |
    | nhs-number                | Python package containing utilities for NHS numbers including validity checks, normalisation and generation. | [GitHub repo](https://github.com/uk-fci/nhs-number) \| [Python Package index](https://pypi.org/project/nhs-number/) \| [Docs](https://nhs-number.uk-fci.tech/) |

    We currently don't have any open source client libraries or sample code for this API. If you think this would be useful, you can [upvote the suggestion on our Interactive Product Backlog](https://nhs-digital-api-management.featureupvote.com/suggestions/107439/client-libraries-and-reference-implementations).

    The source code for the PDS FHIR back end (the Core Spine source code) is not currently in the open. If you think this would be useful, you can [upvote the suggestion on our Interactive Product Backlog](https://nhs-digital-api-management.featureupvote.com/suggestions/466692/open-source-core-spine-including-pds-eps-scr-and-more).

    ## Environments and testing
    | Environment       | Base URL                                                                             |
    | ----------------- | ------------------------------------------------------------------------------------ |
    | Sandbox           | `https://sandbox.api.service.nhs.uk/validated-relationships/FHIR/R4/`    |
    | Integration test  | `https://int.api.service.nhs.uk/validated-relationships/FHIR/R4/`                    |
    | Production        | `https://api.service.nhs.uk/validated-relationships/FHIR/R4/`                        |

    ### Sandbox testing
    Our [sandbox environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#sandbox-testing)

    * is for early developer testing
    * only covers a limited set of scenarios
    * is open access, so does not allow you to test authorisation


    [![Run in Postman](https://run.pstmn.io/button.svg)](https://god.gw.postman.com/run-collection/34042403-2aa5ee88-38a4-4c42-b563-c2d76577d2f2?action=collection%2Ffork&source=rip_markdown&collection-url=entityId%3D34042403-2aa5ee88-38a4-4c42-b563-c2d76577d2f2%26entityType%3Dcollection%26workspaceId%3D19103c6d-7e94-482c-bcc6-07d84bafd9e5)

    ### Integration testing

    Our [integration test environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing)

    * is for formal integration testing
    * includes authorisation with NHS Login

    ## Onboarding
    You must get your software onboarded before it can go live.

    For more details, contact us at [england.vrs-team@nhs.net](mailto:england.vrs-team@nhs.net).

  contact:
    name: 'Validated Relationships Service API Support'
    url: 'https://digital.nhs.uk/developer/help-and-support'
    email: api.management@nhs.net
servers:
  - url: 'https://sandbox.api.service.nhs.uk/validated-relationships/FHIR/R4'
    description: Sandbox environment.
  - url: 'https://int.api.service.nhs.uk/validated-relationships/FHIR/R4'
    description: Integration test environment.
  - url: 'https://api.service.nhs.uk/validated-relationships/FHIR/R4'
    description: Production environment.
paths:
  /QuestionnaireResponse:
    post:
      summary: New Access request
      description: |
        ## Overview
        For any new access request, the necessary details should be collected from a user facing service e.g. 
        Proxy Access Service and submitted as a QuestionnaireResponse. 
        
        For the most part demographics information doesn't need to be provided in the access request since it can be pulled from PDS.

        ## Sandbox test scenarios

        For details of sandbox test scenarios, or to try out the sandbox using our 'Try it out' feature, see the documentation for each endpoint.

      operationId: new-access-request
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/RequestID"
        - $ref: "#/components/parameters/CorrelationID"
      requestBody:
        description: FHIR QuestionnaireResponse
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/QuestionnaireResponse'
          application/fhir+json; charset=utf-8:
            schema: 
              $ref: '#/components/schemas/QuestionnaireResponse'
      responses:
        '200':
          description: Request was received successfully for processing
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
              examples:
                postQuestionnaireResponseSuccess:
                  $ref: '#/components/examples/PostQuestionnaireResponseSuccess'
        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code             | Description                                                                                                                               |
            | ----------- | ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `BAD_REQUEST`          | Bad request.                                                                                                                              |
            | 400         | `NOT_SUPPORTED`        | The request is not currently supported.                                                                                                   |
            | 401         | `ACCESS_DENIED`        | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`            | Access denied to resource.                                                                                                                |
            | 404         | `INVALIDATED_RESOURCE` | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 405         | `METHOD_NOT_ALLOWED`   | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`              | Request timed out.                                                                                                                        |
            | 415         | `UNSUPPORTED_MEDIA`    | Unsupported media type.                                                                                                                    |
            | 429         | `THROTTLED`            | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |
          
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
        "500":
          description: Internal server error
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
              examples:  
                internalServerError:
                  $ref: '#/components/examples/InternalServerError'

  /RelatedPerson:
    get:
      summary: Get verified relationships
      description: |
        ## Overview
        Use this endpoint to get relationships that have been verified against authoritative sources for a proxy with a given NHS Number.

        You can (optionally) include `patient:identifier={nhsNumber}` request parameter with the patient's NHS number to get a specific verified relationship for the proxy.

        You can (optionally) include the `_include=RelatedPerson:patient` request parameter to include the patient's details in the response.

        ## Sandbox test scenarios

        For details of sandbox test scenarios, or to try out the sandbox using our 'Try it out' feature, see the documentation for each endpoint.

      operationId: get-validated-relationships
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/RelatedPersonIdentifier"
        - $ref: "#/components/parameters/PatientIdentifier"
        - $ref: "#/components/parameters/RelatedPersonBundleIncludes"
        - $ref: "#/components/parameters/RequestID"
        - $ref: "#/components/parameters/CorrelationID"
      responses:
        "200":
          description: Information successfully returned. 
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/RelatedPersonBundle"
        "4XX":
          description: |
            Errors will be returned for the first error encountered in the request. An error occurred as follows:

            | HTTP status | Error code                         | Description                                                                                                                               |
            | ----------- | ---------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | `INVALID_IDENTIFIER_SYSTEM`        | Invalid identifier system.                                                                                                                |
            | 400         | `MISSING_IDENTIFIER_VALUE`         | Missing RelatedPerson NHS number.                                                                                                         |
            | 400         | `INVALID_IDENTIFIER_VALUE`         | Malformed RelatedPerson NHS number.                                                                                                       |
            | 400         | `INVALID_PATIENT_IDENTIFIER_VALUE` | Malformed Patient NHS number.                                                                                                             |
            | 400         | `NOT_SUPPORTED`                    | The request is not currently supported.                                                                                                   |
            | 401         | `ACCESS_DENIED`                    | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
            | 403         | `FORBIDDEN`                        | Access denied to resource.                                                                                                                |
            | 404         | `INVALIDATED_RESOURCE`             | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
            | 405         | `METHOD_NOT_ALLOWED`               | The method is not allowed.                                                                                                                |
            | 408         | `TIMEOUT`                          | Request timed out.                                                                                                                        |
            | 429         | `THROTTLED`                        | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |
      
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
        "500":
          description: Internal server error
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
              examples:  
                internalServerError:
                  $ref: '#/components/examples/InternalServerError'

  /Consent:
    get:
        summary: Get proxy relationships
        description: |
          ## Overview
          Use this endpoint to get the details about proxy relationships, including current status, based on a provided proxy's NHS Number.

          You can (optionally) include `status={status}` request parameter to filter the limit the response to records with a given status bound to the http://hl7.org/fhir/consent-state-codes CodeSystem e.g. `status=active`.

          You can (optionally) include the `_include=Consent:performer` request parameter to include the proxy's details in the response.

          You can (optionally) include the `_include=Consent:patient` request parameter to include the patient's details in the response.

          ## Sandbox test scenarios

          For details of sandbox test scenarios, or to try out the sandbox using our 'Try it out' feature, see the documentation for each endpoint.

        operationId: get-consent
        parameters:
          - $ref: "#/components/parameters/BearerAuthorization"
          - $ref: "#/components/parameters/ConsentBundlePerformerIdentifier"
          - $ref: "#/components/parameters/ConsentStatus" 
          - $ref: "#/components/parameters/ConsentBundleIncludes"       
          - $ref: "#/components/parameters/RequestID"
          - $ref: "#/components/parameters/CorrelationID"
          - $ref: "#/components/parameters/Im1ConnectionParams"
        responses:
          "200":
            description: Information successfully returned.
            content:
              application/fhir+json:
                schema:
                  $ref: "#/components/schemas/ConsentBundle"
                examples: 
                  MotherChildConsentBundle:
                    $ref: "#/components/examples/MotherChildConsentBundle"
                  ConsentingAdultsConsentBundle:
                    $ref: "#/components/examples/ConsentingAdultsConsentBundle"
          "4XX":
            description: |
              Errors will be returned for the first error encountered in the request. An error occurred as follows:

              | HTTP status | Error code                         | Description                                                                                                                               |
              | ----------- | ---------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
              | 400         | `MISSING_VALUE`                    | Missing header parameter. For details, see the `diagnostics` field.                                                                       |
              | 400         | `INVALID_VALUE`                    | Invalid header parameter. For details, see the `diagnostics` field.                                                                       |
              | 400         | `INVALID_IDENTIFIER_SYSTEM`        | Invalid identifier system.                                                                                                                |
              | 400         | `MISSING_IDENTIFIER_VALUE`         | Missing performer NHS number.                                                                                                             |
              | 400         | `INVALID_IDENTIFIER_VALUE`         | Malformed performer NHS number.                                                                                                           |              
              | 400         | `NOT_SUPPORTED`                    | The request is not currently supported.                                                                                                   |
              | 401         | `ACCESS_DENIED`                    | Missing or invalid OAuth 2.0 bearer token in request.                                                                                     |
              | 403         | `FORBIDDEN`                        | Access denied to resource.                                                                                                                |
              | 404         | `INVALIDATED_RESOURCE`             | Resource that has been marked as invalid was requested - invalid resources cannot be retrieved                                            |
              | 405         | `METHOD_NOT_ALLOWED`               | The method is not allowed.                                                                                                                |
              | 408         | `TIMEOUT`                          | Request timed out.                                                                                                                        |
              | 429         | `THROTTLED`                        | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |
        
            content:
              application/fhir+json:
                schema:
                  $ref: '#/components/schemas/OperationOutcome'
          "500":
            description: Internal server error
            content:
              application/fhir+json:
                schema:
                  $ref: '#/components/schemas/OperationOutcome'
                examples:  
                  internalServerError:
                    $ref: '#/components/examples/InternalServerError'


components:
  schemas:
    QuestionnaireResponse:
      type: object
      description: A FHIR QuestionnaireResponse
      required:
        - status
        - authored
        - source
        - subject
        - questionnaire
      properties:
        resourceType:
          type: string
          description: The FHIR resource type
          enum: ["QuestionnaireResponse"]
        status:
          type: string
          description: The position of the questionnaire response within its overall lifecycle.
          enum: ["completed"]
        authored: 
          type: string
          format: date-time
          description: The date time that this set of answers were last changed.
          example: "2024-07-15T09:43:03.280Z"
        source: 
          type: object
          description: The person who answered the questions about the subject.
          properties:
            type:
              type: string
              enum: [Patient, RelatedPerson] 
            identifier:
              description: |
                The person who answered the questions about the subject NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a valid NHS number - see:
                https://www.datadictionary.nhs.uk/attributes/nhs_number.html
              properties:
                system:
                  type: string
                  description: Codesystem URL for source's NHS number.
                  enum: ["https://fhir.nhs.uk/Id/nhs-number"]
                value:
                  type: string
                  description: The source's NHS number.
                  example: "9000000001"
        subject: 
          type: object
          description: The person who is the subject.
          properties:
            type:
              type: string
              enum: [Patient]
            identifier:
              description: |
                The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a valid NHS number - see:
                https://www.datadictionary.nhs.uk/attributes/nhs_number.html
              properties:
                system:
                  type: string
                  description: Codesystem URL for the subject's NHS number.
                  enum: ["https://fhir.nhs.uk/Id/nhs-number"]
                value:
                  type: string
                  description: The subject's NHS number.
                  example: "9000000002"
        questionnaire:
          type: string
          description: The Questionnaire that defines and organizes the questions for which answers are being provided.
          example: "Questionnaire/01dc6813-3421-4d14-948d-a4888241add1"
        item:
          type: array
          description: A group or question item from the original questionnaire for which answers are provided.
          items:
            oneOf:
              - $ref: '#/components/schemas/QuestionnaireResponseItem_RelatedPerson'
              - $ref: '#/components/schemas/QuestionnaireResponseItem_ParentalApplicationSupplementaryDetails'
              - $ref: '#/components/schemas/QuestionnaireResponseItem_Patient'
              - $ref: '#/components/schemas/QuestionnaireResponseItem_RequestedAccess'

    QuestionnaireResponseItem_RelatedPerson:
      type: object
      required:
        - linkId
        - text
        - item
      properties:
        linkId:
          type: string
          enum: ["relatedPerson"]
        text:
          type: string
          example: "relatedPerson"
        item:
          type: array
          items:
            oneOf:
              - type: object
                required: 
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_identifier"]
                  text:
                    type: string
                    example: "NHS Number"
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "9000000001"

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_name"]
                  text:
                    type: string
                    example: "relatedPerson_name"
                  item:
                    type: array
                    minItems: 2
                    maxItems: 2
                    items:
                      oneOf:
                        - type: object
                          required:
                            - linkId
                            - text
                            - answer
                          properties:
                            linkId:
                              type: string
                              enum: ["relatedPerson_name_first"]
                            text:
                              type: string
                              example: "First name."
                            answer:
                              type: array
                              minItems: 1
                              maxItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "Sharon"

                        - type: object
                          required:
                            - linkId
                            - text
                            - answer
                          properties:
                            linkId:
                              type: string
                              enum: ["relatedPerson_name_family"]
                            text:
                              type: string
                              example: "Family name (often called Surname)."
                            answer:
                              type: array
                              minItems: 1
                              maxItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "Smith"

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_birthDate"]
                  text:
                    type: string
                    example: "Date of Birth"
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueDate:
                              type: string
                              format: date
                              example: "1994-03-21"

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_basisForAccess"]
                  text:
                    type: string
                    example: "Basis For Access"
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum:
                                    [
                                      "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                                      "https://fhir.hl7.org.uk/CodeSystem/UKCore-AdditionalPersonRelationshipRole",
                                      "https://fhir.nhs.uk/STU3/CodeSystem/RARecord-ProxyRole-1"
                                    ]                                
                                code:
                                  type: string
                                  enum: ['PRN', 'Personal', '002']
                                display:
                                  type: string
                                  description: FHIR relationship type.
                                  enum: ['Parent', 'Personal relationship with the patient', 'Best interest decision made on behalf of the patient (Mental Capacity Act 2005)']

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_relationship"]
                  text:
                    type: string
                    example: "Relationship"
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum:
                                    [
                                      "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                                      "http://terminology.hl7.org/CodeSystem/v3-RoleClass",
                                      "https://fhir.hl7.org.uk/CodeSystem/UKCore-AdditionalPersonRelationshipRole"
                                    ]                                
                                code:
                                  type: string
                                  enum: ['PRN', 'CHILD', 'SPS', 'FAMMEMB', 'FRND', 'CAREGIVER', 'SIGOTHR']
                                display:
                                  type: string
                                  description: FHIR relationship type.
                                  enum: ['Parent', 'Child', 'Partner, wife or husband', 'Other family member', 'Friend, neighbour or housemate', 'Paid carer or support worker', 'Other']

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["relatedPerson_relationshipMoreinfo"]
                  text:
                    type: string
                    example: "Relationship - further information"
                  answer:
                    type: array
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string

    QuestionnaireResponseItem_ParentalApplicationSupplementaryDetails:
      type: object
      properties:
        linkId:
          type: string
          enum: ["parentalApplicationSupplementaryDetails"]
        text:
          type: string
          example: "parentalApplicationSupplementaryDetails"
        item:
          type: array
          items:
            oneOf:
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["parentalApplicationSupplementaryDetails_evidenceOfResponsibility"]
                  text:
                    type: string
                    example: "Evidence of parental responsibility"
                  answer:
                    type: array
                    description: A multiple option selection where multiple items of evidence can be selected
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum: ["https://fhir.nhs.uk/CodeSystem/Proxy-Placeholder-EvidenceOfResponsibility"]                                
                                code:
                                  type: string
                                  enum: ['BRTH', 'ADPT', 'PRNA', 'SPRNA', 'PORD', 'SGORD', 'OTHCOURT', 'OTHR' ]
                                display:
                                  type: string
                                  description: FHIR relationship type.
                                  enum: ['Birth certificate', 'Adoption certificate', 'Court-witnessed parental responsibility agreement','Court-witnessed step-parent parental responsibility agreement', 'Parental order', 'Special guardianship order', 'Other court order', 'Other' ]

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["parentalApplicationSupplementaryDetails_evidenceOfResponsibilityMoreinfo"]
                  text:
                    type: string
                    example: "Evidence of responsibility - Further Information"
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "Birth Certificate is original"
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["parentalApplicationSupplementaryDetails_isCurrentAddressConfirmed"]
                  text:
                    type: string
                    example: "Is current address confirmed?"
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "Yes"                                    

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["parentalApplicationSupplementaryDetails_newAddress"]
                  text:
                    type: string
                    example: "parentalApplicationSupplementaryDetails_newAddress"
                  item:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum: ["parentalApplicationSupplementaryDetails_line1"]
                            text:
                              type: string
                              example: "Address Line 1"
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "24 Hoves Edge"
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum: ["parentalApplicationSupplementaryDetails_line2"]
                            text:
                              type: string
                              example: "Address Line 2"
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "Remington"
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum: ["parentalApplicationSupplementaryDetails_line3"]
                            text:
                              type: string
                              example: "Address Line 3"
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "Boroughbridge"

                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum: ["parentalApplicationSupplementaryDetails_city"]
                            text:
                              type: string
                              example: "Town / City"
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "Leeds"
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum: ["parentalApplicationSupplementaryDetails_district"]
                            text:
                              type: string
                              example: "County"
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "West Yorkshire"
                        - type: object
                          properties:
                            linkId:
                              type: string
                              enum: ["parentalApplicationSupplementaryDetails_postalCode"]
                            text:
                              type: string
                              example: "Postcode"
                            answer:
                              type: array
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "LS1 1DW"

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["parentalApplicationSupplementaryDetails_liveAtSameAddress"]
                  text:
                    type: string
                    example: "Do the adult and child live at the same address?"
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "Yes"

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["parentalApplicationSupplementaryDetails_canChildConsent"]
                  text:
                    type: string
                    example: "Can the child consent?"
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "No"
              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["parentalApplicationSupplementaryDetails_reasonNoChildConsent"]
                  text:
                    type: string
                    example: "Reason the child cannot consent"
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "Child is too young"

    QuestionnaireResponseItem_Patient:
      type: object
      required:
        - linkId
        - text
        - item
      properties:
        linkId:
          type: string
          enum: ["patient"]
        text:
          type: string
          example: "patient"
        item:
          type: array
          items:
            oneOf:
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["patient_identifier"]
                  text:
                    type: string
                    example: "NHS Number"
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "9000000002"

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["patient_name"]
                  text:
                    type: string
                    example: "patient_name"
                  item:
                    type: array
                    minItems: 2
                    maxItems: 2
                    items:
                      oneOf:
                        - type: object
                          required:
                            - linkId
                            - text
                            - answer
                          properties:
                            linkId:
                              type: string
                              enum: ["patient_name_first"]
                            text:
                              type: string
                              example: "First name."
                            answer:
                              type: array
                              minItems: 1
                              maxItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "Jane"
                                        
                        - type: object
                          required:
                            - linkId
                            - text
                            - answer
                          properties:
                            linkId:
                              type: string
                              enum: ["patient_name_family"]
                            text:
                              type: string
                              example: "Family name (often called Surname)."
                            answer:
                              type: array
                              minItems: 1
                              maxItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    properties:
                                      valueString:
                                        type: string
                                        example: "Smith"

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["patient_birthDate"]
                  text:
                    type: string
                    example: "Date of Birth"
                  answer:
                    type: array
                    minItems: 1
                    maxItems: 1
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueDate:
                              type: string
                              format: date
                              example: "2020-10-22"

    QuestionnaireResponseItem_RequestedAccess:
      type: object
      required:
        - linkId
        - text
        - item
      properties:
        linkId:
          type: string
          enum: ["requestedAccess"]
        text:
          type: string
          example: "requestedAccess"
        item:
          type: array
          items:
            oneOf:
              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["requestedAccess_accessLevel"]
                  text:
                    type: string
                    example: "Requested access level"
                  answer:
                    type: array
                    minItems: 1
                    description: A multiple option selection where multiple access levels can be selected
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum: ["https://fhir.nhs.uk/CodeSystem/Proxy-Placeholder-RequestedAccess"]                                
                                code:
                                  type: string
                                  enum: ['APPT', 'CNTCT', 'RECRD', 'TEST', 'VACC', 'PRESCR']
                                display:
                                  type: string
                                  description: FHIR Requested access level.
                                  enum: ['Appointment Booking', 'Contacting Surgery', 'Medical Records Access', 'Test Results', 'Vaccination Records', 'Request and manage repeat prescriptions']

              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["requestedAccess_accessLevelMoreinfo"]
                  text:
                    type: string
                    example: "Requested access level - further information"
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "Access only required to most recent 3 years"

              - type: object
                required:
                  - linkId
                  - text
                  - answer
                properties:
                  linkId:
                    type: string
                    enum: ["requestedAccess_reasonsForAccess"]
                  text:
                    type: string
                    example: "Reason for access"
                  answer:
                    type: array
                    minItems: 1
                    description: A multiple option selection where multiple reasons can be selected
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueCoding:
                              type: object
                              properties:
                                system:
                                  type: string
                                  enum: ["https://fhir.nhs.uk/CodeSystem/Proxy-Placeholder-ReasonForAccess"]                                
                                code:
                                  type: string
                                  enum: ['COMB', 'MHEA', 'PHYS', 'PRAC', 'TECH', 'NEUR', 'LRN', 'OTHR', 'NotSpecified']
                                display:
                                  type: string
                                  description: FHIR Reason for access.
                                  enum: ['Communication Barriers', 'Mental Health Condition', 'Physical Condition', 'Practical Reasons', 'Technical Barriers', 'Neurodiverse', 'Learning Disability', 'Other', 'Prefer not to say']
                                
              - type: object
                properties:
                  linkId:
                    type: string
                    enum: ["requestedAccess_reasonsForAccessMoreinfo"]
                  text:
                    type: string
                    example: "Reason for access - further information"
                  answer:
                    type: array
                    items:
                      oneOf:
                        - type: object
                          properties:
                            valueString:
                              type: string
                              example: "No internet connection"
    
    BaseBundle: 
      type: object
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          enum: [Bundle]        
        timestamp:
          type: string
          format: date-time
          description: The UTC date and time the search results were returned.
          example: 2020-08-26T14:00:00+00:00
        total:
          type: number
          description: |
            The number of resources contained within the Bundle.
          example: 2

    Searchset:
      allOf:
          - $ref: "#/components/schemas/BaseBundle"
          - type: object                       
            properties:
              type:
                  type: string
                  description: Denotes that the Bundle is a collection of resources returned as a result of a search.
                  enum: [searchset]
     
    RelatedPersonBundle:
      allOf:
        - $ref: "#/components/schemas/Searchset"
        - type: object          
          properties:
            link:
              type: array
              items:
                type: object
                properties:
                  relation:
                    type: string
                    description: |
                      Links related to this Bundle - see:
                      http://www.iana.org/assignments/link-relations/link-relations.xhtml
                    example: "self"
                  url:
                    type: string
                    format: uri
                    example: https://api.service.nhs.uk/validated-relationships/FHIR/R4/RelatedPerson?_include=RelatedPerson%3apatient&identifier=https%3A%2F%2Ffhir.nhs.uk%2FId%2Fnhs-number%7C9000000017
            entry:
              type: array
              description: |
                A collection of resources contained within the Bundle.

                An empty bundle suggests that no candidate proxy/patient links were identified.
              items:
                anyOf:
                  - $ref: "#/components/schemas/RelatedPersonBundleEntry"
                  - $ref: "#/components/schemas/PatientBundleEntry"

    ConsentBundle:
      allOf:
        - $ref: "#/components/schemas/Searchset"
        - type: object
          properties:
            entry:
              type: array
              description: |
                A collection of resources contained within the Bundle.

                An empty bundle suggests that the proxy has no proxy relationships.
              items:
                anyOf:
                  - $ref: "#/components/schemas/RelatedPersonBundleEntry"
                  - $ref: "#/components/schemas/PatientBundleEntry"
                  - $ref: "#/components/schemas/ConsentBundleEntry"  
    
    RelatedPersonBundleEntry: 
      type: object
      description: A RelatedPerson bundle entry.
      properties:
        fullUrl:
          type: string
          description: The canonical URL of the resource in the entry
          example: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/RelatedPerson/BE974742"
        resource:
          $ref: "#/components/schemas/RelatedPerson"                        
        search:
          type: object
          properties:
            mode:
              type: string
              enum:
                - match
                - include
                - outcome
              example: match

    PatientBundleEntry: 
      type: object
      description: A Patient bundle entry.
      properties:
        fullUrl:
          type: string
          description: The canonical URL of the resource in the entry
          example: https://api.service.nhs.uk/validated-relationships/FHIR/R4/Patient/A3CC67E2
        resource:          
          $ref: "#/components/schemas/Patient"          
        search:
          type: object
          properties:
            mode:
              type: string
              enum:
                - match
                - include
                - outcome
              example: match

    ConsentBundleEntry: 
      type: object
      description: A Consent bundle entry.
      properties:
        fullUrl:
          type: string
          description: The canonical URL of the resource in the entry
        resource:
          $ref: "#/components/schemas/Consent"
        search:
          type: object
          properties:
            mode:
              type: string
              enum:
                - match
                - include
                - outcome
              example: match

    RelatedPerson:
      type: object
      description: The proxy's details. This includes their relationship to the referenced patient.
      properties:  
        resourceType:
          type: string
          description: FHIR resource type.
          enum: [RelatedPerson] 
          default: RelatedPerson
        id:
          type: string
          description: Unique identifier of the RelatedPerson resource.
          example: BE974742
        identifier:
          type: array
          description: The proxy's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
          items:
            type: object
            properties:
              system:
                type: string
                description: Codesystem URL for the proxy's NHS number.
                enum: ["https://fhir.nhs.uk/Id/nhs-number"]
              value:
                type: string
                description: The proxy's NHS number.
                example: "9000000017"
        patient:
          type: object
          description: A reference to a patient the proxy is related to.
          properties:
            type:
              type: string
              description: FHIR resource type.
              enum: ["Patient"]
            identifier:
              type: object
              description: The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
              properties:
                system:
                  type: string
                  description: Codesystem URL for the patient's NHS number.
                  enum: ["https://fhir.nhs.uk/Id/nhs-number"]
                value:
                  type: string
                  description: The patient's NHS number.
                  example: "9000000009"
        relationship:
          type: array
          description: How the proxy is related to the patient.
          items:
            type: object
            properties:
              coding:
                type: array
                description: FHIR coding array.
                items:
                  type: object
                  properties:
                    system:
                      type: string
                      description: FHIR codesystem.
                      default: "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                      enum:
                        [
                          "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                          "https://fhir.hl7.org.uk/CodeSystem/UKCore-AdditionalPersonRelationshipRole"
                        ]
                    code:
                      type: string
                      description: FHIR relationship type code.
                      enum:
                        - "MTH"
                    display:
                      type: string
                      description: FHIR relationship type.
                      enum:
                        - "mother"  

    Patient:
      type: object
      description: The patient's details.
      properties: 
        resourceType:
          type: string
          description: FHIR resource type.
          enum: [Patient]
          default: Patient
        id:
          type: string
          description: Unique identifier of the Patient resource
          example: A3CC67E2
        identifier:
          type: array
          description: The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
          items:
            type: object
            properties:
              system:
                type: string
                description: Codesystem URL for the NHS number.
                enum: ["https://fhir.nhs.uk/Id/nhs-number"]
              value:
                type: string
                description: The NHS number.
                example: "9000000009"
        name:
          type: array
          description: List of names associated with the patient.
          items:
            type: object
            required:
              - use
              - family
            additionalProperties: false
            properties:
              id:
                type: string
                description: Unique object identifier for this name.
                example: "123"
              use:
                type: string
                description: |
                  How this name should be used.
                  * usual - Known as, conventional or the one patient normally uses. A patient always has a usual name.
                  * temp - An alias or temporary name. This may also be used for temporary names assigned at birth or in emergency situations.
                  * nickname - A name that the patient prefers to be addressed by, but is not part of their usual name.
                  * old - This name is no longer in use (or was never correct, but retained for records).
                  * maiden - Name changed for Marriage. A name used prior to changing name because of marriage. This term is not gender specific. The use of this term does not imply any particular history for a person's name.

                  The following use codes are included in the [name-use](https://www.hl7.org/fhir/valueset-name-use.html) value set, but should not be used and is not be returned as part of a retrieval.
                  * official - The formal name as registered in an official (government) registry, but which name might not be commonly used. May be called "legal name".
                  * anonymous - Anonymous assigned name, alias, or pseudonym (used to protect a person's identity for privacy reasons).
                enum: [usual, temp, nickname, old, maiden]
                example: usual
              period:
                type: object
                description: |
                  Business effective period when the name was, is, or will be in use.
                required:
                  - start
                properties:
                  start:
                    type: string
                    format: date
                    description: Start date of time period, if known, in format `yyyy-mm-dd`. Can be a future date.
                    example: 2020-01-01
                  end:
                    type: string
                    format: date
                    description: End date of time period, if known and if not ongoing, in format `yyyy-mm-dd`. Can be a future date.
                    example: 2021-12-31
              given:
                type: array
                maxItems: 5
                description: |
                  Given names, including any middle names.

                  Each name(s) should be a separate item in the list. The first given name may include multiple names, separated by a space.
                  Subsequent names must be broken down into list items. For example, the input `[Jane Marie Anne, Jo Adele]` returns `[Jane Marie Anne, Jo, Adele]`.

                example: [Jane Marie Anne]
                items:
                  type: string
                  maxLength: 35
                  example: Jane
              family:
                type: string
                maxLength: 35
                description: Family name (often called Surname).
                example: Smith
              prefix:
                type: array
                description: Name prefixes, titles, and prenominals.
                example: [Mrs]
                items:
                  type: string
                  example: Mrs
              suffix:
                type: array
                description: Name suffices and postnominals.
                example: [MBE, PhD]
                items:
                  type: string
                  example: MBE
        birthDate:
          description: |
            The date on which the patient was born or is officially deemed to have been born.

            It is a date in the format `yyyy-mm-dd`. Due to data quality issues on a small number of patients `yyyy-mm` and `yyyy` format may also be returned.
          example: "2010-10-22"
          type: string
          format: date

    Consent: 
      type: object
      description: The details of the consent including who the patient and care "performer" are, status of the relationship and whether consent was given by a patient with capacity.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          enum: 
            - Consent
          default: Consent   
        id:
          type: string
          description: Unique identifier of the Consent resource
        status:
          type: string
          description: "The status of the consent, following the ConsentStateCodes value set ."
          enum: 
            - draft
            - proposed
            - active
            - rejected 
            - inactive
            - entered-in-error
        scope:
          $ref: '#/components/schemas/CodeableConcept'
          description: "The scope of the consent, bound to http://terminology.hl7.org/CodeSystem/consentscope"
          enum: 
            - patient-privacy
        category:
          type: array          
          items:
            $ref: '#/components/schemas/CodeableConcept'
          description: "Classification of the type of consent, bound to http://terminology.hl7.org/CodeSystem/v3-ActCode."
        patient:
          $ref: '#/components/schemas/Reference'
          description: "The patient who is the subject of the consent."          
        dateTime:
          type: string
          format: date-time
          description: "Date and time when the consent was created."
        performer:
          type: array
          items:
            $ref: '#/components/schemas/Reference'
          description: "Individuals or organizations that agreed to the consent."
        policy:
          type: object
          description: Policies covered by this consent
          properties:
            authority: 
              type: string
              description: Organization having regulatory accountability for enforcing policies pertaining to this Consent Directive.
            uri: 
              type: string
              format: uri
              description: The reference to the National Proxy Service policy that are included in this consent scope.
        verification:
          type: array
          description: Whether consent was verified with the patient, or another authorized person.
          items:
            type: object
            properties:
              verified:
                type: boolean
                description: Whether the consent has been verified                
              verifiedWith:
                $ref: '#/components/schemas/Reference'
              verificationDate:
                type: string
                description: The date and time when consent was collected.
                format: date-time

    OperationOutcome:
      type: object
      description: |
        Outcome of an operation that does not result in a resource or bundle being returned, for example an error or an async/batch submission.
        There are a number of possible error codes that can be returned along with a more detailed description in the `display` field.
      properties:
        resourceType:
          type: string
          description: FHIR Resource Type.
          default: OperationOutcome
        issue:
          type: array
          description: List of issues that have occurred.
          minItems: 1
          items:
            type: object
            required:
              - severity
              - code
            properties:
              severity:
                type: string
                enum: [fatal, error, warning, information]
                description: Severity of the error.
                example: error
              code:
                type: string
                description: FHIR error code.
                example: invalid
                enum:
                  - invalid
                  - structure
                  - required
                  - value
                  - invariant
                  - security
                  - login
                  - unknown
                  - expired
                  - forbidden
                  - suppressed
                  - processing
                  - not-supported
                  - duplicate
                  - multiple-matches
                  - not-found
                  - deleted
                  - too-long
                  - code-invalid
                  - extension
                  - too-costly
                  - business-rule
                  - conflict
                  - transient
                  - lock-error
                  - no-store
                  - exception
                  - timeout
                  - incomplete
                  - throttled
                  - informational
              details:
                type: object
                description: Internal error code.
                properties:
                  coding:
                    type: array
                    items:
                      type: object
                      properties:
                        system:
                          type: string
                          description: URI of the coding system specification.
                          example: https://fhir.nhs.uk/R4/CodeSystem/ValidatedRelationships-ErrorOrWarningCode
                        version:
                          type: string
                          description: Version of the coding system in use.
                          example: '1'
                        code:
                          type: string
                          description: Symbol in syntax defined by the system.
                          example: ACCESS_DENIED
                        display:
                          type: string
                          description: Representation defined by the system.
                          example: Missing or invalid OAuth 2.0 bearer token in request.
              diagnostics:
                type: string
                description: Additional diagnostic information about the issue. This information is subject to change.                
              expression:
                type: string
                description: FHIRPath of element(s) related to the error. 
    
    Reference:
      type: object
      properties:        
        identifier:
          $ref: '#/components/schemas/Identifier'

    Identifier:
      type: object
      properties:
        system:
          type: string
          description: "The namespace for the identifier."
        value:
          type: string
          description: "The value that is unique."        

    CodeableConcept:
      type: object
      properties:
        coding:
          type: array
          items:
            $ref: '#/components/schemas/Coding'
        text:
          type: string
          description: "Plain text representation of the concept."

    Coding:
      type: object
      properties:
        system:
          type: string
          description: "The identification of the code system that defines the meaning of the code."
        code:
          type: string
          description: "The actual code from the code system."
        display:
          type: string
          description: "A human-readable representation of the code."

  parameters:
    RelatedPersonIdentifier:
      in: query
      name: identifier
      description: |
        The proxy's NHS number. For more information on FHIR tokens in general, [see here](https://build.fhir.org/search.html#token).
      required: false
      schema:
        type: string
        format: token
      examples:
        withoutSystem:
          value: 9000000009
          summary: NHS number specified without system.
        withSystem:
          value: https://fhir.nhs.uk/Id/nhs-number|9000000009
          summary: System and NHS number specified

    PatientIdentifier:
      in: query
      name: patient:identifier
      description: |
        The patient's NHS number. For more information on FHIR tokens in general, [see here](https://build.fhir.org/search.html#token).
      required: false
      schema:
        type: string
        format: token
      examples:
        withoutSystem:
          value: 9000000017
          summary: NHS number specified without system
        withSystem:
          value: https://fhir.nhs.uk/Id/nhs-number|9000000017
          summary: System and NHS number specified
    
    ConsentBundlePerformerIdentifier:
      in: query
      name: performer:identifier
      description: |
        The performer's (Proxy) NHS number. For more information on FHIR tokens in general, [see here](https://build.fhir.org/search.html#token).
      required: true
      schema:
        type: string
        format: token
      examples:
        withoutSystem:
          value: 9000000017
          summary: NHS number specified without system
        withSystem:
          value: https://fhir.nhs.uk/Id/nhs-number|9000000017
          summary: System and NHS number specified
    
    RelatedPersonBundleIncludes:
      in: query
      name: _include
      description: |
        Include referenced resources in the bundle response by specifying one or more `_include` parameters. Further info [here](https://www.hl7.org/fhir/search.html#_include).
      required: false
      style: form
      explode: true
      schema:
        type: array
        items:
          type: string
          enum:
            - "RelatedPerson:patient"
      examples:         
        IncludePatient:
          summary: Include the patient in the bundle
          value: 
            - "RelatedPerson:patient"

    ConsentBundleIncludes:
      in: query
      name: _include
      description: Include referenced resources in the bundle response by specifying one or more `_include` parameters. Further info [here](https://www.hl7.org/fhir/search.html#_include).
      required: false
      style: form
      explode: true
      schema:
        type: array
        items:
          type: string
          enum:
            - "Consent:performer"
            - "Consent:patient"
      examples: 
        IncludePerformer:
          summary: Include the performer (proxy) in the bundle
          value: Consent:performer
        IncludePatient:
          summary: Include the patient in the bundle
          value: Consent:patient
        FullInclude:
          summary: Include the performer (Proxy) and patient in the bundle
          value: 
            - "Consent:performer"
            - "Consent:patient"
    
    ConsentStatus: 
      in: query
      name: status
      description: Specify one or more `status` to filter the records returned in the bundle. For example you can filter to only `active` or `proposed` proxy relationships.
      required: false      
      style: form
      explode: true
      schema:
        type: array
        items:
          type: string
          enum: 
            - draft
            - proposed
            - active
            - rejected 
            - inactive
            - entered-in-error
      examples:
        Active:
          summary: Only active authorised proxy relationships
          value: active
        Revoked:
          summary: Only revoked proxy relationships
          value: inactive
        ActiveOrProposed:
          summary: Active OR proposed (but not yet authorised) proxy relationships
          value:
            - proposed
            - active

    BearerAuthorization:
      in: header
      name: Authorization
      description: |
        An [OAuth 2.0 bearer token](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis).
      required: true
      schema:
        type: string
        format: '^Bearer\ [[:ascii:]]+$'
        example: "Bearer g1112R_ccQ1Ebbb4gtHBP1aaaNM"
    
    RequestID:
      in: header
      name: X-Request-ID
      required: true
      description: |
        A globally unique identifier (GUID) for the request, which we use to correlate logs through different components.
        Must be a universally unique identifier (UUID) (ideally version 4).
        Mirrored back in a response header.
      schema:
        type: string
        format: uuid
        pattern: "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
        example: 60E0B220-8136-4CA5-AE46-1D97EF59D068
    
    CorrelationID:
      in: header
      name: X-Correlation-ID
      required: false
      description: |
        An optional ID which you can use to track transactions across multiple systems.
        Must be a universally unique identifier (UUID) (ideally version 4).
        Mirrored back in a response header.
      schema:
        type: string
        format: uuid
        pattern: "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
        example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA

    Im1ConnectionParams:
      in: header
      name: X-IM1-Connection-Params
      required: false
      description: |
        An optional `;` delimited string containing parameters required to refresh proxy relationships from GPIT supplier systems. Parameters that comprise this string are:

        - IM1 User Connection token
        - ODS Code
      schema:
        type: string        
        pattern: "^[^;]+;[^;]+$"
        example: NiV3CyMJH3xYV26ghlVpbbjT7pDVEA8HpFczAjRLTs1VezC4CYzupZ3XxXAWM7ELuseqrV8r0Ill7EL7G2tXUaVHCPWgg4q10+MxFjnRPrjDvckBRSZazqZcp0K2VBdUV0rZ7RUYJNJsjVAeefWhiK/Y4R+GFO86QDpt41JS9xA=;G123456

  examples:
    MotherChildConsentBundle:
      summary: Bundle containing a single active proxy relationship for a birth mother & child
      value:
        resourceType: Bundle
        timestamp: "2020-08-26T14:00:00+00:00"
        total: 1
        type: searchset
        entry:
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/RelatedPerson/BE974742"
            resource:
              resourceType: RelatedPerson
              id: BE974742
              identifier:
                - system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000017"
              patient:
                type: Patient
                identifier:
                  system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000009"
              relationship:
                - coding:
                    - system: "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                      code: PRN
                      display: Parent
                    - system: "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                      code: MTH
                      display: mother
            search:
              mode: include
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/Patient/A3CC67E2"
            resource:
              resourceType: Patient
              id: A3CC67E2
              identifier:
                - system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000009"
              name:
                - id: "123456"
                  use: usual
                  period:
                    start: "2020-01-01"
                    end: "2021-12-31"
                  given:
                    - "Jane Marie Anne"
                  family: Smith
                  prefix:
                    - Mrs
                  suffix:
                    - MBE
                    - PhD
              birthDate: "2022-10-22"
            search:
              mode: include
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/Consent/BBCC67E9"
            resource:
              resourceType: Consent
              id: BBCC67E9
              status: active
              scope:
                coding:
                  - system: http://terminology.hl7.org/CodeSystem/consentscope"
                    code: patient-privacy
                    display: "Patient Privacy"
                text: "Patient Privacy Consent"
              category:
                - coding:
                    - system: "http://terminology.hl7.org/CodeSystem/v3-ActCode"
                      code: INFA
                      display: "Information Access"
                  text: "Information Access Consent"
              patient:
                identifier:
                  system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000009"
              dateTime: "2024-07-21T17:32:28Z"
              performer:
                - identifier:
                    system: "https://fhir.nhs.uk/Id/nhs-number"
                    value: "9000000017"
              policy:
                authority: "https://www.england.nhs.uk"
                uri: "<REPLACE WITH LINK TO PUBLISHED NATIONAL PROXY STANDARD>"
            search:
              mode: match

    ConsentingAdultsConsentBundle:
      summary: Bundle containing a single active proxy relationship for two consenting adults with capacity
      value:
        resourceType: Bundle
        timestamp: "2020-08-26T14:00:00+00:00"
        total: 1
        type: searchset
        entry:
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/RelatedPerson/RP974720"
            resource:
              resourceType: RelatedPerson
              id: RP974720
              identifier:
                - system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000010"
              patient:
                type: Patient
                identifier:
                  system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000005"
              relationship:
                - coding:
                    - system: "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                      code: Personal
                      display: "Personal relationship with the patient"                    
            search:
              mode: include
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/Patient/DFCC67F5"
            resource:
              resourceType: Patient
              id: DFCC67F5
              identifier:
                - system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000005"
              name:
                - id: "123456"
                  use: usual
                  period:
                    start: "2020-01-01"
                    end: "2021-12-31"
                  given:
                    - "Sally"
                  family: Evans
                  prefix:
                    - Mrs
              birthDate: "1995-10-22"
            search:
              mode: include
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/Consent/WWCC67T1"
            resource:
              resourceType: Consent
              id: WWCC67T1
              status: active
              scope:
                coding:
                  - system: http://terminology.hl7.org/CodeSystem/consentscope"
                    code: patient-privacy
                    display: "Patient Privacy"
                text: "Patient Privacy Consent"
              category:
                - coding:
                    - system: "http://terminology.hl7.org/CodeSystem/v3-ActCode"
                      code: INFA
                      display: "Information Access"
                  text: "Information Access Consent"
              patient:
                identifier:
                  system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000005"
              dateTime: "2024-07-21T17:32:28Z"
              performer:
                - identifier:
                    system: "https://fhir.nhs.uk/Id/nhs-number"
                    value: "9000000010"
              policy:
                authority: "https://www.england.nhs.uk"
                uri: "<REPLACE WITH LINK TO PUBLISHED NATIONAL PROXY STANDARD>"
              verification:
                - verified: true
                  verifiedWith:
                    identifier:
                      system: "https://fhir.nhs.uk/Id/nhs-number"
                      value: "9000000005"
                  verificationDate: "2024-07-21T17:32:28Z"
            search:
              mode: match

    MultipleConsentBundle:
      summary: Bundle containing a multiple active proxy relationships
      value:
        resourceType: Bundle
        timestamp: "2020-08-26T14:00:00+00:00"
        total: 1
        type: searchset
        entry:
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/RelatedPerson/BE974742"
            resource:
              resourceType: RelatedPerson
              id: BE974742
              identifier:
                - system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000017"
              patient:
                type: Patient
                identifier:
                  system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000009"
              relationship:
                - coding:
                    - system: "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                      code: PRN
                      display: Parent
                    - system: "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                      code: MTH
                      display: mother
            search:
              mode: include
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/Patient/A3CC67E2"
            resource:
              resourceType: Patient
              id: A3CC67E2
              identifier:
                - system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000009"
              name:
                - id: "123456"
                  use: usual
                  period:
                    start: "2020-01-01"
                    end: "2021-12-31"
                  given:
                    - "Jane Marie Anne"
                  family: Smith
                  prefix:
                    - Mrs
                  suffix:
                    - MBE
                    - PhD
              birthDate: "2022-10-22"
            search:
              mode: include
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/Consent/BBCC67E9"
            resource:
              resourceType: Consent
              id: BBCC67E9
              status: active
              scope:
                coding:
                  - system: http://terminology.hl7.org/CodeSystem/consentscope"
                    code: patient-privacy
                    display: "Patient Privacy"
                text: "Patient Privacy Consent"
              category:
                - coding:
                    - system: "http://terminology.hl7.org/CodeSystem/v3-ActCode"
                      code: INFA
                      display: "Information Access"
                  text: "Information Access Consent"
              patient:
                identifier:
                  system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000009"
              dateTime: "2024-07-21T17:32:28Z"
              performer:
                - identifier:
                    system: "https://fhir.nhs.uk/Id/nhs-number"
                    value: "9000000017"
              policy:
                authority: "https://www.england.nhs.uk"
                uri: "<REPLACE WITH LINK TO PUBLISHED NATIONAL PROXY STANDARD>"
            search:
              mode: match
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/RelatedPerson/RP974720"
            resource:
              resourceType: RelatedPerson
              id: RP974720
              identifier:
                - system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000010"
              patient:
                type: Patient
                identifier:
                  system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000005"
              relationship:
                - coding:
                    - system: "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                      code: Personal
                      display: "Personal relationship with the patient"                    
            search:
              mode: include
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/Patient/DFCC67F5"
            resource:
              resourceType: Patient
              id: DFCC67F5
              identifier:
                - system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000005"
              name:
                - id: "123456"
                  use: usual
                  period:
                    start: "2020-01-01"
                    end: "2021-12-31"
                  given:
                    - "Sally"
                  family: Evans
                  prefix:
                    - Mrs
              birthDate: "1995-10-22"
            search:
              mode: include
          - fullUrl: "https://api.service.nhs.uk/validated-relationships/FHIR/R4/Consent/WWCC67T1"
            resource:
              resourceType: Consent
              id: WWCC67T1
              status: active
              scope:
                coding:
                  - system: http://terminology.hl7.org/CodeSystem/consentscope"
                    code: patient-privacy
                    display: "Patient Privacy"
                text: "Patient Privacy Consent"
              category:
                - coding:
                    - system: "http://terminology.hl7.org/CodeSystem/v3-ActCode"
                      code: INFA
                      display: "Information Access"
                  text: "Information Access Consent"
              patient:
                identifier:
                  system: "https://fhir.nhs.uk/Id/nhs-number"
                  value: "9000000005"
              dateTime: "2024-07-21T17:32:28Z"
              performer:
                - identifier:
                    system: "https://fhir.nhs.uk/Id/nhs-number"
                    value: "9000000010"
              policy:
                authority: "https://www.england.nhs.uk"
                uri: "<REPLACE WITH LINK TO PUBLISHED NATIONAL PROXY STANDARD>"
              verification:
                - verified: true
                  verifiedWith:
                    identifier:
                      system: "https://fhir.nhs.uk/Id/nhs-number"
                      value: "9000000005"
                  verificationDate: "2024-07-21T17:32:28Z"
            search:
              mode: match

    InternalServerError:
      value:
        resourceType: "OperationOutcome"
        issue: 
          - severity: error
            code: invalid
            diagnostics: "Internal Server Error - Failed to generate response is present in the response"          
            details:
              coding:
               - system: "https://fhir.nhs.uk/R4/CodeSystem/ValidatedRelationships-ErrorOrWarningCode"
                 version: "1"
                 code: "SERVER_ERROR"
                 display: "Failed to generate response"
    
    PostQuestionnaireResponseSuccess:
      value:
        resourceType: "OperationOutcome"
        issue: 
          - severity: information
            code: informational
            details:
              coding:
               - code: "HDJ2123F"
                 display: "HDJ2123F"    
